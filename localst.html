
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage Dashboard</title>
    <style>
       

:root {
    --twitter-blue: #1DA1F2;
    --twitter-blue-hover: #1a91da;
    --twitter-blue-light: #8ED0F9;
    --twitter-black: #14171A;
    --twitter-dark-gray: #657786;
    --twitter-light-gray: #AAB8C2;
    --twitter-extra-light-gray: #E1E8ED;
    --twitter-background: #F5F8FA;
    --twitter-white: #FFFFFF;
    --positive-green: #17BF63;
    --negative-red: #E0245E;
    --card-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    --card-hover-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    --transition-speed: 0.2s;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

body {
    background-color: var(--twitter-white);
    color: var(--twitter-black);
    min-height: 100vh;
    line-height: 1.5;
    font-size: 16px;
}

.container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 12px;
}

.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--twitter-extra-light-gray);
    flex-wrap: wrap;
    gap: 10px;
}

.header-title {
    font-size: 20px;
    font-weight: 800;
    display: flex;
    align-items: center;
    letter-spacing: -0.5px;
}

.twitter-icon {
    color: var(--twitter-blue);
    margin-right: 12px;
}

.refresh-btn {
    background-color: var(--twitter-blue);
    color: white;
    border: none;
    border-radius: 30px;
    padding: 8px 16px;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: background-color var(--transition-speed), transform var(--transition-speed);
    box-shadow: 0 2px 5px rgba(29, 161, 242, 0.2);
}

.refresh-btn:hover {
    background-color: var(--twitter-blue-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(29, 161, 242, 0.3);
}

.refresh-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 3px rgba(29, 161, 242, 0.2);
}

.refresh-btn svg {
    margin-right: 10px;
}

.date-display {
    font-size: 14px;
    color: var(--twitter-dark-gray);
    margin-bottom: 15px;
    font-weight: 500;
}

.dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}

.stat-card {
    background-color: var(--twitter-white);
    border-radius: 16px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    border: 1px solid var(--twitter-extra-light-gray);
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--card-hover-shadow);
    border-color: #d0d9e0;
}

.stat-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: var(--twitter-blue);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
}

.stat-card:hover::after {
    transform: scaleX(1);
}

.card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
}

.card-title {
    font-size: 15px;
    font-weight: 600;
    color: var(--twitter-dark-gray);
}

.card-icon {
    width: 40px;
    height: 40px;
    background-color: var(--twitter-blue);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 4px 10px rgba(29, 161, 242, 0.25);
    transition: transform 0.2s ease;
}

.stat-card:hover .card-icon {
    transform: scale(1.05);
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 12px;
    letter-spacing: -0.5px;
    word-break: break-word;
}

.stat-change {
    font-size: 13px;
    display: flex;
    align-items: center;
    font-weight: 500;
}

.stat-change.positive {
    color: var(--positive-green);
}

.stat-change.negative {
    color: var(--negative-red);
}

.storage-details {
    background-color: var(--twitter-white);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--twitter-extra-light-gray);
    transition: box-shadow 0.3s ease;
    overflow-x: auto;
}

.storage-details:hover {
    box-shadow: var(--card-hover-shadow);
}

.storage-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
}

.storage-title {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: -0.5px;
}

.storage-actions {
    display: flex;
    gap: 8px;
}

.action-btn {
    background-color: #F2F3F5;
    border: none;
    border-radius: 30px;
    padding: 8px 16px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all var(--transition-speed);
    display: flex;
    align-items: center;
}

.action-btn:hover {
    background-color: #E5E8EC;
    transform: translateY(-2px);
}

.action-btn:active {
    transform: translateY(0);
}

.action-btn.danger {
    color: var(--negative-red);
}

.action-btn.danger:hover {
    background-color: rgba(224, 36, 94, 0.1);
}

.action-btn svg {
    margin-right: 8px;
}

.storage-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    border-radius: 8px;
    overflow: hidden;
    min-width: 300px;
}

.storage-table th {
    text-align: left;
    padding: 12px 14px;
    background-color: var(--twitter-background);
    border-bottom: 1px solid var(--twitter-extra-light-gray);
    font-weight: 600;
    color: var(--twitter-black);
    white-space: nowrap;
}

.storage-table td {
    padding: 12px 14px;
    border-bottom: 1px solid var(--twitter-extra-light-gray);
    vertical-align: top;
}

.storage-table tbody tr {
    transition: background-color 0.15s ease;
}

.storage-table tbody tr:hover {
    background-color: #F8FAFC;
}

.key-column {
    width: 25%;
    font-weight: 600;
    color: var(--twitter-blue);
    word-break: break-all;
}

.value-column {
    width: 60%;
    overflow-wrap: break-word;
    word-break: break-all;
    max-height: 120px;
    overflow-y: auto;
}

.size-column {
    width: 15%;
    text-align: right;
    color: var(--twitter-dark-gray);
    font-weight: 500;
    white-space: nowrap;
}

.json-viewer {
    white-space: pre-wrap;
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    font-size: 12px;
    line-height: 1.5;
    color: #333;
    background-color: #F8F9FA;
    padding: 10px;
    border-radius: 6px;
    max-height: 150px;
    overflow-y: auto;
    border: 1px solid #E8EEF2;
    overflow-x: auto;
}

.storage-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    padding-top: 16px;
    border-top: 1px solid var(--twitter-extra-light-gray);
    font-size: 13px;
    color: var(--twitter-dark-gray);
    font-weight: 500;
    flex-wrap: wrap;
    gap: 10px;
}

.chart-container {
    background-color: var(--twitter-white);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: var(--card-shadow);
    height: 300px;
    border: 1px solid var(--twitter-extra-light-gray);
    transition: box-shadow 0.3s ease;
}

.chart-container:hover {
    box-shadow: var(--card-hover-shadow);
}

.chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
}

.chart-title {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: -0.5px;
}

.chart-tabs {
    display: flex;
    gap: 4px;
    background-color: #F2F3F5;
    padding: 4px;
    border-radius: 30px;
    overflow-x: auto;
    max-width: 100%;
    -webkit-overflow-scrolling: touch;
}

.chart-tab {
    padding: 6px 12px;
    border-radius: 30px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-speed);
    white-space: nowrap;
}

.chart-tab.active {
    background-color: var(--twitter-blue);
    color: white;
    box-shadow: 0 2px 5px rgba(29, 161, 242, 0.2);
}

.chart-tab:not(.active) {
    background-color: transparent;
    color: var(--twitter-dark-gray);
}

.chart-tab:not(.active):hover {
    background-color: rgba(0, 0, 0, 0.05);
    color: var(--twitter-black);
}

.chart {
    height: calc(100% - 50px);
    position: relative;
    overflow: hidden;
}

.chart svg {
    width: 100%;
    height: 100%;
    overflow: visible;
}

.chart-line {
    fill: none;
    stroke: var(--twitter-blue);
    stroke-width: 2.5;
    stroke-linecap: round;
    stroke-linejoin: round;
}

.chart-area {
    fill: url(#area-gradient);
    opacity: 0.25;
}

.chart-dot {
    fill: var(--twitter-blue);
    stroke: white;
    stroke-width: 2;
    cursor: pointer;
    transition: r 0.2s ease, stroke-width 0.2s ease;
}

.chart-label {
    font-size: 11px;
    fill: var(--twitter-dark-gray);
    font-weight: 500;
    dominant-baseline: middle;
    text-anchor: middle;
}

.chart-grid-line {
    stroke: var(--twitter-extra-light-gray);
    stroke-width: 1;
    stroke-dasharray: 5,5;
}

.chart-axis {
    stroke: var(--twitter-extra-light-gray);
    stroke-width: 1;
}

.chart-tooltip {
    position: absolute;
    background-color: rgba(20, 23, 26, 0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    z-index: 1000;
    pointer-events: none;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transform: translateY(-8px);
    transition: opacity 0.2s, transform 0.2s;
}

.loading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(3px);
}

.spinner {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 3px solid rgba(29, 161, 242, 0.2);
    border-top-color: var(--twitter-blue);
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 0.8; }
    50% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); opacity: 0.8; }
}

@keyframes slideInUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.animate-in {
    animation: slideInUp 0.4s ease forwards;
}

/* Enhanced Responsive Styles */
@media (max-width: 991px) {
    .dashboard {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
    
    .chart-container {
        height: 280px;
    }
}

@media (max-width: 768px) {
    body {
        font-size: 15px;
    }
    
    .container {
        padding: 10px;
    }
    
    .dashboard {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 12px;
    }
    
    .stat-card {
        padding: 16px;
    }
    
    .card-icon {
        width: 36px;
        height: 36px;
    }
    
    .stat-value {
        font-size: 24px;
    }
    
    .chart-container {
        height: 260px;
        padding: 16px;
    }
    
    .storage-table th:nth-child(3),
    .storage-table td:nth-child(3) {
        display: none;
    }
}

@media (max-width: 576px) {
    .container {
        padding: 8px;
    }
    
    .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .refresh-btn {
        align-self: flex-start;
    }
    
    .dashboard {
        grid-template-columns: 1fr;
    }
    
    .stat-card {
        padding: 16px;
    }
    
    .stat-value {
        font-size: 22px;
    }
    
    .chart-container {
        height: 220px;
        padding: 15px;
    }
    
    .chart-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .chart-tabs {
        width: 100%;
        justify-content: space-between;
        margin-top: 8px;
    }
    
    .chart-tab {
        padding: 5px 10px;
        font-size: 12px;
        flex: 1;
        text-align: center;
    }
    
    .storage-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .storage-actions {
        margin-top: 10px;
        width: 100%;
        justify-content: space-between;
    }
    
    .action-btn {
        padding: 6px 12px;
    }
    
    .action-btn span {
        display: none;
    }
    
    .action-btn svg {
        margin-right: 0;
    }
    
    .storage-table {
        font-size: 12px;
    }
    
    .storage-table th,
    .storage-table td {
        padding: 10px;
    }
    
    .storage-footer {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .json-viewer {
        font-size: 11px;
        padding: 8px;
        max-height: 120px;
    }
}

@media (max-width: 400px) {
    .header-title {
        font-size: 16px;
    }
    
    .date-display {
        font-size: 12px;
    }
    
    .stat-card {
        padding: 12px;
    }
    
    .card-title {
        font-size: 13px;
    }
    
    .card-icon {
        width: 32px;
        height: 32px;
    }
    
    .stat-value {
        font-size: 20px;
        margin-bottom: 8px;
    }
    
    .stat-change {
        font-size: 11px;
    }
    
    .chart-container {
        height: 200px;
        padding: 12px;
    }
    
    .chart-title, .storage-title {
        font-size: 16px;
    }
    
    .storage-details {
        padding: 12px;
    }
    
    .storage-table th,
    .storage-table td {
        padding: 8px 6px;
    }
    
    .key-column {
        width: 40%;
    }
    
    .value-column {
        width: 60%;
    }
}

/* Ensure flexibility for extremely small screens */
@media (max-width: 320px) {
    body {
        font-size: 14px;
    }
    
    .header-title {
        font-size: 15px;
    }
    
    .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .stat-value {
        font-size: 18px;
    }
    
    .chart-container {
        height: 180px;
    }
    
    .chart svg text {
        font-size: 9px;
    }
    
    .chart-tabs {
        padding: 2px;
    }
    
    .chart-tab {
        padding: 4px 8px;
        font-size: 11px;
    }
}

/* High-contrast dark mode support */
@media (prefers-contrast: more) {
    .chart-line {
        stroke-width: 4;
    }
    
    .chart-dot {
        stroke-width: 3;
    }
    
    .key-column {
        color: #0078d4;
    }
    
    .action-btn.danger {
        color: #d13438;
    }
}

    </style>
</head>
<body>
    <div class="loading" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1 class="header-title">
                
            <button class="refresh-btn" id="refreshBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M23 4v6h-6"></path>
                    <path d="M1 20v-6h6"></path>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                    <path d="M20.49 15a9 9 0 0 1-14.85 3.36L1 14"></path>
                </svg>
                Refresh Data
            </button>
        </div>

        <div class="date-display" id="currentDate"></div>

        <div class="dashboard">
            <div class="stat-card animate-in" style="animation-delay: 0.1s">
                <div class="card-header">
                    <span class="card-title">Total Messages</span>
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </div>
                </div>
                <div class="stat-value" id="totalMessagesValue">--</div>
                <div class="stat-change positive" id="messagesChange">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                    <span>-- from yesterday</span>
                </div>
            </div>

            <div class="stat-card animate-in" style="animation-delay: 0.2s">
                <div class="card-header">
                    <span class="card-title">Storage Used</span>
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        </svg>
                    </div>
                </div>
                <div class="stat-value" id="storageUsedValue">--</div>
                <div class="stat-change" id="storageChange">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                    <span>-- of total capacity</span>
                </div>
            </div>

            <div class="stat-card animate-in" style="animation-delay: 0.3s">
                <div class="card-header">
                    <span class="card-title">Conversation Status</span>
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4"></path>
                            <path d="M12 8h.01"></path>
                        </svg>
                    </div>
                </div>
                <div class="stat-value" id="conversationStatusValue">--</div>
                <div class="stat-change" id="conversationChange">
                    <span>Active conversations</span>
                </div>
            </div>
        </div>

        <div class="chart-container animate-in" style="animation-delay: 0.4s">
            <div class="chart-header">
                <div class="chart-title">Message Activity</div>
                <div class="chart-tabs">
                    <div class="chart-tab active" data-period="day">Today</div>
                    <div class="chart-tab" data-period="week">This Week</div>
                    <div class="chart-tab" data-period="month">This Month</div>
                </div>
            </div>
            <div class="chart" id="activityChart">
                <svg viewBox="0 0 800 200" preserveAspectRatio="none">
                    <!-- Gradient for area chart -->
                    <defs>
                        <linearGradient id="area-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#1DA1F2" stop-opacity="0.5"/>
                            <stop offset="100%" stop-color="#1DA1F2" stop-opacity="0.1"/>
                        </linearGradient>
                    </defs>
                    
                    <!-- Grid lines -->
                    <line class="chart-grid-line" x1="0" y1="40" x2="800" y2="40"/>
                    <line class="chart-grid-line" x1="0" y1="80" x2="800" y2="80"/>
                    <line class="chart-grid-line" x1="0" y1="120" x2="800" y2="120"/>
                    <line class="chart-grid-line" x1="0" y1="160" x2="800" y2="160"/>
                    
                    <!-- Y-axis labels -->
                    <text class="chart-label" x="10" y="45">High</text>
                    <text class="chart-label" x="10" y="85">Medium</text>
                    <text class="chart-label" x="10" y="125">Low</text>
                    <text class="chart-label" x="10" y="165">None</text>
                    
                    <!-- X-axis -->
                    <line class="chart-axis" x1="50" y1="180" x2="780" y2="180"/>
                    
                    <!-- X-axis labels -->
                    <text class="chart-label" x="100" y="195">12 AM</text>
                    <text class="chart-label" x="250" y="195">6 AM</text>
                    <text class="chart-label" x="400" y="195">12 PM</text>
                    <text class="chart-label" x="550" y="195">6 PM</text>
                    <text class="chart-label" x="700" y="195">11 PM</text>
                    
                    <!-- Data will be inserted here by JavaScript -->
                </svg>
            </div>
        </div>

        <div class="storage-details animate-in" style="animation-delay: 0.5s">
            <div class="storage-header">
                <div class="storage-title">LocalStorage Contents</div>
                <div class="storage-actions">
                    <button class="action-btn" id="exportBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        <span>Export</span>
                    </button>
                    <button class="action-btn danger" id="clearBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        <span>Clear All</span>
                    </button>
                </div>
            </div>
            
            <table class="storage-table">
                <thead>
                    <tr>
                        <th class="key-column">Key</th>
                        <th class="value-column">Value</th>
                        <th class="size-column">Size</th>
                    </tr>
                </thead>
                <tbody id="storageTableBody">
                    <!-- Local storage data will be inserted here by JavaScript -->
                </tbody>
            </table>
            
            <div class="storage-footer">
                <div id="totalItems">Total items: --</div>
                <div id="totalSize">Total size: --</div>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // DOM Cache
    const dom = {
        date: document.getElementById('currentDate'),
        messages: document.getElementById('totalMessagesValue'),
        messagesChange: document.getElementById('messagesChange'),
        storageUsed: document.getElementById('storageUsedValue'),
        storageChange: document.getElementById('storageChange'),
        status: document.getElementById('conversationStatusValue'),
        statusChange: document.getElementById('conversationChange'),
        tableBody: document.getElementById('storageTableBody'),
        totalItems: document.getElementById('totalItems'),
        totalSize: document.getElementById('totalSize'),
        refreshBtn: document.getElementById('refreshBtn'),
        exportBtn: document.getElementById('exportBtn'),
        clearBtn: document.getElementById('clearBtn'),
        chartTabs: document.querySelectorAll('.chart-tab'),
        chartSvg: document.querySelector('#activityChart svg'),
        loading: document.getElementById('loadingOverlay')
    };

    // Constants
    const STORAGE_LIMIT = 5 * 1024 * 1024; // 5MB
    const MSG_KEY = 'localMessages';
    const CONV_KEY = 'conversationStatus';

    // State
    let prevMsgCount = 0;
    let currentPeriod = 'day';
    let chartData = generateSampleData(); // Initialize with sample data

    // Initialize
    initDashboard();

    function initDashboard() {
        updateDate();
        loadStorage();
        setupEvents();
        renderChart();
        setTimeout(hideLoading, 200);
    }

    function updateDate() {
        const now = new Date();
        dom.date.textContent = now.toLocaleDateString('en-US', { 
            weekday: 'short', 
            month: 'short', 
            day: 'numeric' 
        });
    }

    function setupEvents() {
        dom.refreshBtn.onclick = refreshDashboard;
        dom.exportBtn.onclick = exportStorage;
        dom.clearBtn.onclick = confirmClear;

        dom.chartTabs.forEach(tab => {
            tab.onclick = function() {
                currentPeriod = this.dataset.period;
                dom.chartTabs.forEach(t => t.classList.toggle('active', t === this));
                renderChart();
            };
        });
    }

    function refreshDashboard() {
        showLoading();
        setTimeout(() => {
            loadStorage();
            updateChartData(); // Regenerate chart data
            renderChart();
            hideLoading();
        }, 150);
    }

    function loadStorage() {
        let totalSize = 0;
        let itemCount = 0;
        
        // Fast table clearing
        dom.tableBody.innerHTML = '';
        
        // Process storage
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (!key) continue;
            
            const value = localStorage.getItem(key);
            if (!value) continue;
            
            const size = value.length * 2; // Approximate size
            totalSize += size;
            itemCount++;
            
            addTableRow(key, value, size);
        }
        
        // Update UI
        dom.totalItems.textContent = `Items: ${itemCount}`;
        dom.totalSize.textContent = `Size: ${formatSize(totalSize)}`;
        updateMetrics(totalSize);
    }

    function addTableRow(key, value, size) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="key-column">${key}</td>
            <td class="value-column">${value.length > 100 ? value.substring(0, 100) + '...' : value}</td>
            <td class="size-column">${formatSize(size)}</td>
        `;
        dom.tableBody.appendChild(row);
    }

    function updateMetrics(totalSize) {
        // Messages count
        const messages = localStorage.getItem(MSG_KEY) || '';
        const msgCount = messages.split('||').filter(Boolean).length;
        
        dom.messages.textContent = msgCount;
        updateMsgChange(msgCount);
        
        // Storage usage
        dom.storageUsed.textContent = formatSize(totalSize);
        updateStoragePercent(totalSize);
        
        // Conversation status
        const convStatus = localStorage.getItem(CONV_KEY) || '';
        const activeConvs = convStatus.split('full').length - 1;
        
        dom.status.textContent = activeConvs > 0 ? 'Active' : 'Inactive';
        dom.statusChange.innerHTML = `<span>${activeConvs} active</span>`;
        
        prevMsgCount = msgCount;
    }

    function updateMsgChange(current) {
        if (prevMsgCount === 0) {
            dom.messagesChange.innerHTML = `<span>New tracking</span>`;
            return;
        }
        
        const diff = current - prevMsgCount;
        const isPositive = diff > 0;
        
        dom.messagesChange.className = isPositive ? 'stat-change positive' : 'stat-change negative';
        dom.messagesChange.innerHTML = `
            <svg width="14" height="14" viewBox="0 0 24 24">
                <polyline points="${isPositive ? '18 15 12 9 6 15' : '6 9 12 15 18 9'}"></polyline>
            </svg>
            <span>${isPositive ? '+' : ''}${diff}</span>
        `;
    }

    function updateStoragePercent(size) {
        const percent = Math.round((size / STORAGE_LIMIT) * 100);
        dom.storageChange.innerHTML = `<span>${percent}% used</span>`;
        dom.storageChange.className = percent > 80 ? 'stat-change negative' : 'stat-change positive';
    }

    function generateSampleData() {
        // Generate realistic sample data for the chart
        return {
            day: Array.from({length: 24}, (_, i) => 
                Math.round(Math.random() * 20 + (i > 8 && i < 18 ? 30 : 10))),
            week: Array.from({length: 7}, (_, i) => 
                Math.round(Math.random() * 30 + (i < 5 ? 50 : 20))),
            month: Array.from({length: 30}, (_, i) => 
                Math.round(Math.random() * 40 + (i % 7 < 5 ? 60 : 30)))
        };
    }

    function updateChartData() {
        // Update chart data based on actual storage
        const messages = localStorage.getItem(MSG_KEY) || '';
        const msgTimestamps = messages.split('||').filter(Boolean).map(m => {
            const parts = m.split('|');
            return parts.length > 1 ? parseInt(parts[1]) || Date.now() : Date.now();
        });

        const now = Date.now();
        const oneDay = 24 * 60 * 60 * 1000;
        
        // Reset data
        chartData = {
            day: Array(24).fill(0),
            week: Array(7).fill(0),
            month: Array(30).fill(0)
        };

        // Process each message timestamp
        msgTimestamps.forEach(timestamp => {
            const date = new Date(timestamp);
            const hoursAgo = (now - timestamp) / (60 * 60 * 1000);
            const daysAgo = (now - timestamp) / oneDay;

            // Today's data
            if (hoursAgo < 24) {
                const hour = date.getHours();
                chartData.day[hour]++;
            }

            // This week's data
            if (daysAgo < 7) {
                const day = date.getDay(); // 0 (Sun) to 6 (Sat)
                chartData.week[day]++;
            }

            // This month's data
            if (daysAgo < 30) {
                const day = Math.floor(daysAgo);
                if (day >= 0 && day < 30) {
                    chartData.month[day]++;
                }
            }
        });
    }

    function renderChart() {
        // Clear previous chart elements
        ['chart-line', 'chart-area', 'chart-dot'].forEach(cls => {
            const el = dom.chartSvg.querySelector(`.${cls}`);
            if (el) el.remove();
        });

        const data = chartData[currentPeriod];
        const max = Math.max(...data, 1);
        const path = generateChartPath(data, max);
        
        // Create and append new path
        const pathEl = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        pathEl.setAttribute('class', 'chart-line');
        pathEl.setAttribute('d', path);
        dom.chartSvg.appendChild(pathEl);

        // Add dots for data points
        data.forEach((value, i) => {
            if (value > 0) {
                const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                dot.setAttribute('class', 'chart-dot');
                dot.setAttribute('cx', 50 + (i * (700 / (data.length - 1))));
                dot.setAttribute('cy', 20 + (160 - (value / max) * 160));
                dot.setAttribute('r', '4');
                dot.setAttribute('data-value', value);
                
                // Simple tooltip
                dot.addEventListener('mouseover', function() {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'chart-tooltip';
                    tooltip.textContent = value;
                    tooltip.style.left = `${this.getBoundingClientRect().left}px`;
                    tooltip.style.top = `${this.getBoundingClientRect().top - 30}px`;
                    document.body.appendChild(tooltip);
                    this.setAttribute('r', '6');
                });
                
                dot.addEventListener('mouseout', function() {
                    const tooltip = document.querySelector('.chart-tooltip');
                    if (tooltip) tooltip.remove();
                    this.setAttribute('r', '4');
                });
                
                dom.chartSvg.appendChild(dot);
            }
        });
    }

    function generateChartPath(data, max) {
        let path = '';
        const step = 700 / (data.length - 1);
        
        data.forEach((value, i) => {
            const x = 50 + (i * step);
            const y = 20 + (160 - (value / max) * 160);
            path += `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
        });
        
        return path;
    }

    function exportStorage() {
        try {
            const data = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key) data[key] = localStorage.getItem(key);
            }
            
            const blob = new Blob([JSON.stringify(data)], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'storage_export.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            setTimeout(() => URL.revokeObjectURL(url), 50);
        } catch (e) {
            alert('Export failed');
        }
    }

    function confirmClear() {
        if (confirm('Clear all storage?')) {
            localStorage.clear();
            loadStorage();
            updateChartData();
            renderChart();
        }
    }

    function formatSize(bytes) {
        return bytes < 1024 ? bytes + 'B' :
               bytes < 1048576 ? (bytes/1024).toFixed(1) + 'KB' :
               (bytes/1048576).toFixed(1) + 'MB';
    }

    function showLoading() {
        dom.loading.style.display = 'flex';
    }

    function hideLoading() {
        dom.loading.style.display = 'none';
    }
});
</script>
<script>

(function() {
  // LocalStorage Dashboard Theme Manager
  const LocalStorageThemeManager = {
    // Theme configuration with appropriate colors for the dashboard
    themeConfig: {
      light: {
        '--twitter-blue': '#1DA1F2',
        '--twitter-blue-hover': '#1a91da',
        '--twitter-blue-light': '#8ED0F9',
        '--twitter-black': '#14171A',
        '--twitter-dark-gray': '#657786',
        '--twitter-light-gray': '#AAB8C2',
        '--twitter-extra-light-gray': '#E1E8ED',
        '--twitter-background': '#F5F8FA',
        '--twitter-white': '#FFFFFF',
        '--positive-green': '#17BF63',
        '--negative-red': '#E0245E',
        '--card-shadow': '0 2px 10px rgba(0, 0, 0, 0.05)',
        '--card-hover-shadow': '0 5px 15px rgba(0, 0, 0, 0.1)'
      },
      dim: {
        '--twitter-blue': '#1DA1F2',
        '--twitter-blue-hover': '#1a91da',
        '--twitter-blue-light': '#1A91DA',
        '--twitter-black': '#f1f1f1',
        '--twitter-dark-gray': '#8899a6',
        '--twitter-light-gray': '#6A7884',
        '--twitter-extra-light-gray': '#38444d',
        '--twitter-background': '#15202b',
        '--twitter-white': '#192734',
        '--positive-green': '#17BF63',
        '--negative-red': '#E0245E',
        '--card-shadow': '0 2px 10px rgba(0, 0, 0, 0.2)',
        '--card-hover-shadow': '0 5px 15px rgba(0, 0, 0, 0.3)'
      },
      dark: {
        '--twitter-blue': '#1DA1F2',
        '--twitter-blue-hover': '#1a91da',
        '--twitter-blue-light': '#1A91DA',
        '--twitter-black': '#ffffff',
        '--twitter-dark-gray': '#8899a6',
        '--twitter-light-gray': '#6A7884',
        '--twitter-extra-light-gray': '#2f3336',
        '--twitter-background': '#000000',
        '--twitter-white': '#16181c',
        '--positive-green': '#17BF63',
        '--negative-red': '#E0245E',
        '--card-shadow': '0 2px 10px rgba(0, 0, 0, 0.3)',
        '--card-hover-shadow': '0 5px 15px rgba(0, 0, 0, 0.4)'
      }
    },
    
    // Unique style element ID
    styleElementId: 'localstorage-dashboard-theme-styles',
    
    // Initialize the theme manager
    initialize: function() {
      this.createStyleElement();
      this.applyCurrentTheme();
      this.setupEventListeners();
      console.log('LocalStorage Dashboard Theme Manager initialized');
    },
    
    // Create dedicated style element
    createStyleElement: function() {
      const existingStyle = document.getElementById(this.styleElementId);
      if (existingStyle) {
        existingStyle.remove();
      }
      
      const styleElement = document.createElement('style');
      styleElement.id = this.styleElementId;
      styleElement.setAttribute('data-origin', 'localstorage-dashboard-theme-manager');
      document.head.appendChild(styleElement);
    },
    
    // Apply current theme based on localStorage
    applyCurrentTheme: function() {
      const themeName = localStorage.getItem('twitter-theme') || 'light';
      this.applyTheme(themeName);
    },
    
    // Apply specified theme
    applyTheme: function(themeName) {
      // Default to light theme if invalid theme name
      const validThemes = ['light', 'dim', 'dark'];
      const theme = validThemes.includes(themeName) ? themeName : 'light';
      
      // Get theme configuration
      const themeVars = this.themeConfig[theme] || this.themeConfig.light;
      
      // Get style element
      const styleElement = document.getElementById(this.styleElementId);
      if (!styleElement) {
        this.createStyleElement();
        return this.applyTheme(theme); // Retry after creating style element
      }
      
      // Generate CSS with theme variables
      let css = '';
      
      // Add CSS variables
      css += ':root {\n';
      Object.entries(themeVars).forEach(([key, value]) => {
        css += ` ${key}: ${value};\n`;
      });
      css += '}\n\n';
      
      // Add theme-specific overrides for dashboard elements
      if (theme === 'dim' || theme === 'dark') {
        css += `
        /* Dashboard Theme Overrides for Dark Modes */
        body {
          background-color: var(--twitter-background);
          color: var(--twitter-black);
        }

        .container {
          background-color: var(--twitter-background);
        }

        .header {
          border-bottom-color: var(--twitter-extra-light-gray);
        }

        .stat-card {
          background-color: var(--twitter-white);
          border-color: var(--twitter-extra-light-gray);
          color: var(--twitter-black);
        }

        .card-title {
          color: var(--twitter-dark-gray);
        }

        .stat-value {
          color: var(--twitter-black);
        }

        .storage-details, .chart-container {
          background-color: var(--twitter-white);
          border-color: var(--twitter-extra-light-gray);
        }

        .storage-table th {
          background-color: var(--twitter-background);
          color: var(--twitter-black);
          border-bottom-color: var(--twitter-extra-light-gray);
        }

        .storage-table td {
          border-bottom-color: var(--twitter-extra-light-gray);
          color: var(--twitter-black);
        }

        .storage-table tbody tr:hover {
          background-color: rgba(255, 255, 255, 0.05);
        }

        .key-column {
          color: var(--twitter-blue);
        }

        .size-column {
          color: var(--twitter-dark-gray);
        }

        .json-viewer {
          background-color: rgba(0, 0, 0, 0.2);
          border-color: var(--twitter-extra-light-gray);
          color: var(--twitter-light-gray);
        }

        .chart-label {
          fill: var(--twitter-dark-gray);
        }

        .chart-grid-line, .chart-axis {
          stroke: var(--twitter-extra-light-gray);
        }

        .action-btn {
          background-color: rgba(255, 255, 255, 0.1);
        }

        .action-btn:hover {
          background-color: rgba(255, 255, 255, 0.15);
        }

        .chart-tab:not(.active) {
          color: var(--twitter-dark-gray);
        }

        .chart-tab:not(.active):hover {
          background-color: rgba(255, 255, 255, 0.1);
        }

        .date-display {
          color: var(--twitter-dark-gray);
        }

        .storage-footer {
          color: var(--twitter-dark-gray);
          border-top-color: var(--twitter-extra-light-gray);
        }

        .loading {
          background-color: rgba(0, 0, 0, 0.7);
        }
        `;
      }
      
      // Set the CSS content
      styleElement.textContent = css;
      
      // Add a class to the body for theme identification
      document.body.classList.remove('theme-light', 'theme-dim', 'theme-dark');
      document.body.classList.add(`theme-${theme}`);
      
      console.log('LocalStorage Dashboard Theme Manager: Applied theme', theme);
    },
    
    // Set up event listeners
    setupEventListeners: function() {
      // Listen for localStorage changes
      window.addEventListener('storage', (e) => {
        if (e.key === 'twitter-theme') {
          this.applyTheme(e.newValue || 'light');
        }
      });
      
      // Periodic theme check to ensure consistency
      this.setupPeriodicCheck();
    },
    
    // Set up periodic check for theme consistency
    setupPeriodicCheck: function() {
      let lastKnownTheme = localStorage.getItem('twitter-theme') || 'light';
      
      setInterval(() => {
        const currentTheme = localStorage.getItem('twitter-theme');
        if (currentTheme !== lastKnownTheme) {
          lastKnownTheme = currentTheme || 'light';
          this.applyTheme(lastKnownTheme);
        }
      }, 3000); // Check every 3 seconds
    },
    
    // Utility function to toggle between themes (for testing)
    toggleTheme: function() {
      const currentTheme = localStorage.getItem('twitter-theme') || 'light';
      const themes = ['light', 'dim', 'dark'];
      const currentIndex = themes.indexOf(currentTheme);
      const nextIndex = (currentIndex + 1) % themes.length;
      const nextTheme = themes[nextIndex];
      
      localStorage.setItem('twitter-theme', nextTheme);
      this.applyTheme(nextTheme);
      return nextTheme;
    }
  };
  
  // Initialize the theme manager when DOM is loaded
  function initializeThemeManager() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        LocalStorageThemeManager.initialize();
      });
    } else {
      // DOM is already ready
      LocalStorageThemeManager.initialize();
    }
  }
  
  // Start the theme manager
  initializeThemeManager();
})();

</script>
<script>
 
(function() {
  // Initialize color palette for localStorage dashboard
  applyColorPalette();
  
  // Listen for changes in localStorage
  window.addEventListener('storage', function(event) {
    if (event.key === 'color-value' || event.key === 'color-palette') {
      applyColorPalette();
    }
  });
  
  // Listen for custom events
  window.addEventListener('dashboardColorChanged', function(event) {
    applyColorPalette();
  });
  
  function applyColorPalette() {
    const savedColorValue = localStorage.getItem('color-value');
    const savedColorIndex = localStorage.getItem('color-palette');
    
    // Only apply if we have a valid color and it's not the default blue
    if (savedColorValue && savedColorIndex !== '0') {
      // Convert hex to RGB
      const colorObj = hexToRGB(savedColorValue);
      const rgbString = `${colorObj.r}, ${colorObj.g}, ${colorObj.b}`;
      
      // Create style element for all overrides
      let styleEl = document.getElementById('dashboard-color-palette-style');
      if (!styleEl) {
        styleEl = document.createElement('style');
        styleEl.id = 'dashboard-color-palette-style';
        document.head.appendChild(styleEl);
      }
      
      // Apply to all dashboard elements that use the twitter blue color
      styleEl.textContent = `
        /* Override Twitter Blue variables */
        :root {
          --twitter-blue: ${savedColorValue} !important;
          --twitter-blue-hover: ${darkenColor(savedColorValue, 0.1)} !important;
          --twitter-blue-light: ${lightenColor(savedColorValue, 0.3)} !important;
        }
        
        /* Card top border on hover */
        .stat-card::after {
          background: ${savedColorValue} !important;
        }
        
        /* Card icons */
        .card-icon {
          background-color: ${savedColorValue} !important;
          box-shadow: 0 4px 10px rgba(${rgbString}, 0.25) !important;
        }
        
        /* Refresh button */
        .refresh-btn {
          background-color: ${savedColorValue} !important;
          box-shadow: 0 2px 5px rgba(${rgbString}, 0.2) !important;
        }
        .refresh-btn:hover {
          background-color: ${darkenColor(savedColorValue, 0.1)} !important;
          box-shadow: 0 4px 8px rgba(${rgbString}, 0.3) !important;
        }
        
        /* Chart elements */
        .chart-line {
          stroke: ${savedColorValue} !important;
        }
        .chart-dot {
          fill: ${savedColorValue} !important;
        }
        .chart-area {
          fill: url(#area-gradient) !important;
        }
        .chart-tab.active {
          background-color: ${savedColorValue} !important;
          box-shadow: 0 2px 5px rgba(${rgbString}, 0.2) !important;
        }
        
        /* Key column in storage table */
        .key-column {
          color: ${savedColorValue} !important;
        }
        
        /* Spinner in loading overlay */
        .spinner {
          border-top-color: ${savedColorValue} !important;
          border-color: rgba(${rgbString}, 0.2) !important;
        }
        
        /* Update area gradient for chart */
        #area-gradient stop:first-child {
          stop-color: ${savedColorValue} !important;
        }
      `;
      
      // Update the gradient definition
      updateGradientColors(savedColorValue);
    } else {
      // Remove all custom styles to revert to default
      const styleEl = document.getElementById('dashboard-color-palette-style');
      if (styleEl) {
        styleEl.remove();
      }
    }
  }
  
  function updateGradientColors(color) {
    // Find the gradient definition and update its colors
    const gradientEl = document.querySelector('linearGradient#area-gradient');
    if (gradientEl) {
      const stops = gradientEl.querySelectorAll('stop');
      if (stops.length >= 2) {
        stops[0].setAttribute('stop-color', color);
        stops[0].setAttribute('stop-opacity', '0.5');
        stops[1].setAttribute('stop-color', color);
        stops[1].setAttribute('stop-opacity', '0.1');
      }
    }
  }
  
  function hexToRGB(hex) {
    hex = hex.replace('#', '');
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);
    return { r, g, b };
  }
  
  function darkenColor(hex, percent) {
    hex = hex.replace('#', '');
    let r = parseInt(hex.substring(0, 2), 16);
    let g = parseInt(hex.substring(2, 4), 16);
    let b = parseInt(hex.substring(4, 6), 16);
    
    r = Math.floor(r * (1 - percent));
    g = Math.floor(g * (1 - percent));
    b = Math.floor(b * (1 - percent));
    
    r = Math.max(0, r);
    g = Math.max(0, g);
    b = Math.max(0, b);
    
    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
  }
  
  function lightenColor(hex, percent) {
    hex = hex.replace('#', '');
    let r = parseInt(hex.substring(0, 2), 16);
    let g = parseInt(hex.substring(2, 4), 16);
    let b = parseInt(hex.substring(4, 6), 16);
    
    r = Math.floor(r + (255 - r) * percent);
    g = Math.floor(g + (255 - g) * percent);
    b = Math.floor(b + (255 - b) * percent);
    
    r = Math.min(255, r);
    g = Math.min(255, g);
    b = Math.min(255, b);
    
    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
  }
})();

</script>
<script>
// Font size synchronization script
(function() {
    // Function to apply font size from localStorage
    function applyFontSize() {
        const size = localStorage.getItem('font-size') || '1';
        document.body.style.fontSize = size + 'rem';
        
        // Add scaling to different elements if needed
        const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
        const paragraphs = document.querySelectorAll('p');
        const buttons = document.querySelectorAll('button');
        const inputs = document.querySelectorAll('input');
        
        headings.forEach(heading => {
            const currentSize = window.getComputedStyle(heading).fontSize;
            const baseSize = parseFloat(currentSize) / 16; // convert to rem
            heading.style.fontSize = (baseSize * parseFloat(size)) + 'rem';
        });
        
        paragraphs.forEach(p => {
            p.style.fontSize = size + 'rem';
        });
        
        buttons.forEach(button => {
            button.style.fontSize = (parseFloat(size) * 0.9) + 'rem';
        });
        
        inputs.forEach(input => {
            input.style.fontSize = size + 'rem';
        });
    }
    
    // Apply immediately
    applyFontSize();
    
    // Listen for changes
    window.addEventListener('storage', function(event) {
        if (event.key === 'font-size') {
            applyFontSize();
        }
    });
    
    // Check every second for changes (backup method)
    setInterval(function() {
        const currentSize = document.body.style.fontSize;
        const savedSize = localStorage.getItem('font-size') || '1';
        
        if (currentSize !== savedSize + 'rem') {
            applyFontSize();
        }
    }, 1000);
})();
</script>