<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Post</title>
  <style>
    /* Base Reset & Typography */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    :root {
        --primary-color: #626262;
        --primary-light: #f0f0f0;
        --primary-dark: #3a3a3a;
        --text-primary: #333;
        --text-secondary: #666;
        --background-light: #f9f9f9;
        --background-white: #ffffff;
        --border-light: #e0e0e0;
        --border-radius-sm: 8px;
        --border-radius-md: 16px;
        --border-radius-lg: 24px;
        --transition-speed: 0.25s;
        --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        --luxury-gradient: linear-gradient(
            135deg,  
            #0f0f0f 0%,  
            #1c1c1c 15%,  
            #3a3a3a 30%,  
            #4d4d4d 45%,  
            #626262 60%,  
            #787878 75%,  
            #8f8f8f 90%,  
            #a6a6a6 100%
        );
        --border-color: #dadada;
    }

    html, body {
        height: 100%;
        font-size: 16px;
        color: var(--text-primary);
    }

    body {
      display: flex;
      flex-direction: column;
      background-color: var(--background-white);
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    /* Post Container */
    .post-container {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--background-white);
      border-radius: var(--border-radius-md);
      box-shadow: var(--box-shadow);
      padding: 20px;
    }

    .post-header {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }

    .profile-image {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      margin-right: 14px;
      object-fit: cover;
      border: 2px solid var(--border-light);
    }

    .user-name {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 1rem;
    }

    /* Media Preview */
    .media-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
    }

    .preview-item {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: var(--border-radius-md);
      overflow: hidden;
      box-shadow: var(--box-shadow);
    }

    .preview-image, .preview-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .remove-media {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 24px;
      height: 24px;
      background-color: rgba(0, 0, 0, 0.6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: white;
      font-size: 14px;
      border: none;
      transition: all var(--transition-speed);
    }

    .remove-media:hover {
      background-color: rgba(240, 40, 40, 0.8);
      transform: scale(1.1);
    }

    /* Input Area */
    .input-wrapper {
      display: flex;
      flex-direction: column;
      margin-bottom: 16px;
    }

    .post-textarea {
      width: 100%;
      min-height: 120px;
      border: 1px solid var(--border-light);
      border-radius: var(--border-radius-md);
      padding: 12px;
      font-size: 1rem;
      resize: none;
      margin-bottom: 12px;
      transition: border-color var(--transition-speed);
    }

    .post-textarea:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .post-textarea::placeholder {
      color: var(--text-secondary);
      opacity: 0.7;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .media-buttons {
      display: flex;
      gap: 12px;
    }

    .media-button {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform var(--transition-speed);
      opacity: 0.8;
    }

    .media-button:hover {
      transform: scale(1.1);
      opacity: 1;
    }

    .media-button svg {
      width: 24px;
      height: 24px;
      fill: currentColor;
    }

    .post-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius-lg);
      padding: 10px 24px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-speed);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .post-button:hover:not(:disabled) {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
    }

    .post-button:active:not(:disabled) {
      transform: translateY(0);
    }

    .post-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .file-input {
      display: none;
    }

    /* Drafts Section */
    .drafts-section {
      margin-top: 24px;
      border-top: 1px solid var(--border-light);
      padding-top: 16px;
    }

    .drafts-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .drafts-title {
      font-weight: 600;
      color: var(--text-primary);
    }

    .toggle-drafts {
      background: none;
      border: none;
      color: var(--primary-color);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .drafts-list {
      display: none;
      margin-top: 12px;
    }

    .drafts-list.show {
      display: block;
    }

    .draft-item {
      padding: 12px;
      border: 1px solid var(--border-light);
      border-radius: var(--border-radius-md);
      margin-bottom: 8px;
      cursor: pointer;
      transition: background-color var(--transition-speed);
    }

    .draft-item:hover {
      background-color: var(--primary-light);
    }

    .draft-text {
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .draft-media-count {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Loading Animation */
    .loading-indicator {
      display: none;
      justify-content: center;
      align-items: center;
      padding: 12px;
    }

    .loading-dot {
      width: 8px;
      height: 8px;
      margin: 0 4px;
      border-radius: 50%;
      background-color: var(--primary-color);
      animation: bounce 0.6s infinite alternate;
    }

    .loading-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .loading-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes bounce {
      from { transform: translateY(0); }
      to { transform: translateY(-8px); }
    }

    /* Success Message */
    .success-message {
      display: none;
      background-color: #4CAF50;
      color: white;
      padding: 12px;
      border-radius: var(--border-radius-md);
      margin-top: 16px;
      text-align: center;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      body {
        padding: 12px;
      }

      .post-container {
        padding: 16px;
      }

      .profile-image {
        width: 42px;
        height: 42px;
      }

      .preview-item {
        width: 100px;
        height: 100px;
      }

      .post-textarea {
        min-height: 100px;
      }
    }

    @media (max-width: 480px) {
      .profile-image {
        width: 38px;
        height: 38px;
      }

      .preview-item {
        width: 80px;
        height: 80px;
      }

      .post-button {
        padding: 8px 16px;
      }

      .media-button svg {
        width: 20px;
        height: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="post-container">
    <div class="post-header">
      <img id="profileImage" class="profile-image" src="https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" alt="Profile">
      <span class="user-name" id="userName">You</span>
    </div>

    <div class="input-wrapper">
      <textarea id="postInput" class="post-textarea" placeholder="What's on your mind?" rows="4"></textarea>
      
      <div class="media-preview" id="mediaPreview"></div>
      
      <div class="action-buttons">
        <div class="media-buttons">
          <button class="media-button" id="imageButton" title="Add image">
            <svg viewBox="0 0 24 24">
              <path d="M19.75 2H4.25C3.01 2 2 3.01 2 4.25v15.5C2 20.99 3.01 22 4.25 22h15.5c1.24 0 2.25-1.01 2.25-2.25V4.25C22 3.01 20.99 2 19.75 2zM4.25 3.5h15.5c.413 0 .75.337.75.75v9.676l-3.858-3.858c-.14-.14-.33-.22-.53-.22h-.003c-.2 0-.393.08-.532.224l-4.317 4.384-1.813-1.806c-.14-.14-.33-.22-.53-.22-.193-.03-.395.08-.535.227L3.5 17.642V4.25c0-.413.337-.75.75-.75zm-.744 16.28l5.418-5.534 6.282 6.254H4.25c-.402 0-.727-.322-.744-.72zm16.244.72h-2.42l-5.007-4.987 3.792-3.85 4.385 4.384v3.703c0 .413-.337.75-.75.75z"></path>
              <circle cx="8.868" cy="8.309" r="1.542"></circle>
            </svg>
          </button>
          <button class="media-button" id="videoButton" title="Add video">
            <svg viewBox="0 0 24 24">
              <path d="M21 6.3c0-.7-.6-1.3-1.3-1.3H4.3C3.6 5 3 5.6 3 6.3v11.4c0 .7.6 1.3 1.3 1.3h15.4c.7 0 1.3-.6 1.3-1.3V6.3zm-2 0v11.4H5V6.3h14z"></path>
              <path d="M9.6 15l5.1-3-5.1-3v6z"></path>
            </svg>
          </button>
          <input type="file" id="imageInput" class="file-input" accept="image/*" multiple>
          <input type="file" id="videoInput" class="file-input" accept="video/*" multiple>
        </div>
        <button id="postButton" class="post-button" disabled>Post</button>
      </div>
    </div>

    <div class="loading-indicator" id="loadingIndicator">
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
    </div>

    <div class="success-message" id="successMessage">
      Post created successfully!
    </div>

    <div class="drafts-section">
      <div class="drafts-header">
        <span class="drafts-title">Your Drafts</span>
        <button class="toggle-drafts" id="toggleDrafts">
          <span>Show</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M6 9l6 6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
      </div>
      <div class="drafts-list" id="draftsList"></div>
    </div>
  </div>

  <!-- Firebase and Appwrite SDKs -->

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDnPz8BWCaXJOazlFVO4Eap8VxdSR2oDFQ",
      authDomain: "globalchat-2d669.firebaseapp.com",
      projectId: "globalchat-2d669",
      messagingSenderId: "178714711978",
      appId: "1:178714711978:web:fb831188be23e62a4bbdd3",
      databaseURL: "https://globalchat-2d669-default-rtdb.firebaseio.com/"
    };

    // Appwrite Configuration
    const APPWRITE_ENDPOINT = "https://cloud.appwrite.io/v1";
    const APPWRITE_PROJECT_ID = "67d98c24003a405ab6a0"; 
    const APPWRITE_BUCKET_ID = "67dba33e000399dc8641"; 
    const APPWRITE_API_KEY = "standard_6f65a2d8e8c270ba9556f844789c1eae72c7fa71f64b95409ac20b6127c483454d1e4b9f8c13f82c09168ed1dfebd2d4e7e02494bee254252f9713675beea4d645a960879aaada1c6c98cb7651ec6c6bf4357e4c2c8b8d666c0166203ec43694b9a49ec8ee08161edf3fd5dea94e46c165316122f44f96c44933121be214b80c";

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const database = getDatabase(app);
    // CHANGED: Use 'messages' instead of 'posts' to match reading script
    const messagesRef = ref(database, 'messages');
    const rateLimitRef = ref(database, 'rateLimit');

    // DOM Elements
    const postInput = document.getElementById('postInput');
    const imageInput = document.getElementById('imageInput');
    const videoInput = document.getElementById('videoInput');
    const imageButton = document.getElementById('imageButton');
    const videoButton = document.getElementById('videoButton');
    const mediaPreview = document.getElementById('mediaPreview');
    const postButton = document.getElementById('postButton');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const successMessage = document.getElementById('successMessage');
    const profileImage = document.getElementById('profileImage');
    const userName = document.getElementById('userName');
    const toggleDrafts = document.getElementById('toggleDrafts');
    const draftsList = document.getElementById('draftsList');

    // State
    let currentUser = null;
    let selectedMedia = [];
    let drafts = JSON.parse(localStorage.getItem('postDrafts') || '[]');
    let draftsVisible = false;
    let lastPostTime = 0;

    // Get country code from IP (new function)
    async function getCountryFromIP() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        return data.country_code.toLowerCase();
      } catch (error) {
        console.error('Error getting country:', error);
        return 'unknown';
      }
    }

    // Initialize app
    function init() {
      // Event listeners
      imageButton.addEventListener('click', () => imageInput.click());
      videoButton.addEventListener('click', () => videoInput.click());
      imageInput.addEventListener('change', handleMediaSelection);
      videoInput.addEventListener('change', handleMediaSelection);
      postButton.addEventListener('click', createPost);
      postInput.addEventListener('input', updatePostButtonState);
      toggleDrafts.addEventListener('click', toggleDraftsVisibility);

      // Set up auth state observer
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          try {
            const userDoc = await getDoc(doc(db, 'users', user.uid));
            const userData = userDoc.data() || {};
            const countryCode = await getCountryFromIP();
            
            currentUser = {
              uid: user.uid,
              displayName: user.displayName || userData?.displayName || "User" + Math.floor(Math.random() * 10000),
              photoURL: user.photoURL || userData?.photoURL || "https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png",
              country: countryCode
            };

            // Update UI
            profileImage.src = currentUser.photoURL;
            userName.textContent = currentUser.displayName;

            // Create user in database if not exists
            if (!userDoc.exists()) {
              await setDoc(doc(db, 'users', user.uid), {
                displayName: currentUser.displayName,
                photoURL: currentUser.photoURL,
                createdAt: new Date().toISOString()
              });
            }

            // Load drafts
            renderDrafts();
          } catch (error) {
            console.error('Error initializing user:', error);
          }
        } else {
          // Sign in anonymously if no user
          signInAnonymously(auth).catch(error => {
            console.error('Anonymous auth error:', error);
          });
        }
      });
    }

    // Handle media selection
    function handleMediaSelection(e) {
      const files = e.target.files;
      if (!files.length) return;

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const fileType = file.type.split('/')[0]; // 'image' or 'video'
        
        if (selectedMedia.length >= 4) {
          alert('You can only attach up to 4 media files');
          break;
        }

        // Check file size (10MB limit)
        if (file.size > 10 * 1024 * 1024) {
          alert('File size exceeds 10MB limit');
          continue;
        }

        // Create preview
        const reader = new FileReader();
        reader.onload = function(e) {
          const previewItem = document.createElement('div');
          previewItem.className = 'preview-item';
          
          if (fileType === 'image') {
            previewItem.innerHTML = `
              <img src="${e.target.result}" class="preview-image">
              <button class="remove-media" data-index="${selectedMedia.length}">×</button>
            `;
          } else if (fileType === 'video') {
            previewItem.innerHTML = `
              <video src="${e.target.result}" class="preview-video" controls></video>
              <button class="remove-media" data-index="${selectedMedia.length}">×</button>
            `;
          }
          
          mediaPreview.appendChild(previewItem);
          
          // Add remove event
          previewItem.querySelector('.remove-media').addEventListener('click', function() {
            const index = parseInt(this.getAttribute('data-index'));
            removeMedia(index);
          });
        };
        
        reader.readAsDataURL(file);
        selectedMedia.push({
          file: file,
          type: fileType,
          previewUrl: URL.createObjectURL(file)
        });
      }

      // Reset file input and update button state
      e.target.value = '';
      updatePostButtonState();
    }

    // Remove media
    function removeMedia(index) {
      // Revoke object URL to free memory
      URL.revokeObjectURL(selectedMedia[index].previewUrl);
      
      selectedMedia.splice(index, 1);
      updateMediaPreview();
      updatePostButtonState();
    }

    // Update media preview
    function updateMediaPreview() {
      mediaPreview.innerHTML = '';
      
      selectedMedia.forEach((media, index) => {
        const previewItem = document.createElement('div');
        previewItem.className = 'preview-item';
        
        if (media.type === 'image') {
          previewItem.innerHTML = `
            <img src="${media.previewUrl}" class="preview-image">
            <button class="remove-media" data-index="${index}">×</button>
          `;
        } else if (media.type === 'video') {
          previewItem.innerHTML = `
            <video src="${media.previewUrl}" class="preview-video" controls></video>
            <button class="remove-media" data-index="${index}">×</button>
          `;
        }
        
        mediaPreview.appendChild(previewItem);
        
        // Add remove event
        previewItem.querySelector('.remove-media').addEventListener('click', function() {
          removeMedia(index);
        });
      });
    }

    // Update post button state
    function updatePostButtonState() {
      const hasText = postInput.value.trim().length > 0;
      const hasMedia = selectedMedia.length > 0;
      postButton.disabled = !(hasText || hasMedia);
      
      // Save draft when content changes
      saveDraft();
    }

    // Upload media to Appwrite
    async function uploadMedia(file) {
      try {
        // Create a unique filename
        const fileName = `${currentUser.uid}_${Date.now()}_${file.name}`;
        const fileType = file.type.split('/')[0]; // 'image' or 'video'
        
        // Create form data for upload
        const formData = new FormData();
        formData.append('file', file);
        formData.append('bucketId', APPWRITE_BUCKET_ID);
        
        // Upload to Appwrite
        const response = await fetch(`${APPWRITE_ENDPOINT}/storage/buckets/${APPWRITE_BUCKET_ID}/files`, {
          method: 'POST',
          headers: {
            'X-Appwrite-Project': APPWRITE_PROJECT_ID,
            'X-Appwrite-Key': APPWRITE_API_KEY
          },
          body: formData
        });
        
        if (!response.ok) {
          throw new Error(`Upload failed with status: ${response.status}`);
        }
        
        const result = await response.json();
        
        // Get the file URL
        const fileUrl = `${APPWRITE_ENDPOINT}/storage/buckets/${APPWRITE_BUCKET_ID}/files/${result.$id}/view?project=${APPWRITE_PROJECT_ID}`;
        
        return {
          url: fileUrl,
          type: fileType
        };
      } catch (error) {
        console.error('Media upload error:', error);
        
        // Fallback to data URL if upload fails
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (event) => {
            resolve({
              url: event.target.result,
              type: file.type.split('/')[0]
            });
          };
          reader.readAsDataURL(file);
        });
      }
    }

    // Create post
    async function createPost() {
      if (!currentUser) {
        alert('Please wait while we authenticate you');
        return;
      }

      const postText = postInput.value.trim();
      const currentTime = Date.now();
      const hasMedia = selectedMedia.length > 0;

      // Check if content exists
      if (!postText && !hasMedia) return;

      // Check rate limit (3 seconds between posts)
      if (currentTime - lastPostTime < 3000) {
        alert('Please wait a few seconds before posting again');
        return;
      }

      try {
        // Show loading indicator
        loadingIndicator.style.display = 'flex';
        postButton.disabled = true;
        
        // Update global rate limit
        await set(rateLimitRef, currentTime);
        
        // Upload all media files
        const mediaUrls = [];
        if (hasMedia) {
          for (const media of selectedMedia) {
            const uploadResult = await uploadMedia(media.file);
            mediaUrls.push(uploadResult);
          }
        }

        // Create new post
        // CHANGED: Use messagesRef instead of postsRef
        const newPostRef = push(messagesRef);
        await set(newPostRef, {
          userId: currentUser.uid,
          name: currentUser.displayName,
          photoURL: currentUser.photoURL,
          text: postText,
          media: mediaUrls,
          timestamp: currentTime,
          country: currentUser.country, // Added country field to match reader
          replyCount: 0 // Added replyCount field to match reader
        });

        // Reset UI
        postInput.value = '';
        selectedMedia = [];
        mediaPreview.innerHTML = '';
        postButton.disabled = true;
        lastPostTime = currentTime;
        
        // Clear current draft
        clearCurrentDraft();
        
        // Show success message
        successMessage.style.display = 'block';
        setTimeout(() => {
          successMessage.style.display = 'none';
        }, 3000);
      } catch (error) {
        console.error('Error creating post:', error);
        alert('Failed to create post. Please try again.');
      } finally {
        loadingIndicator.style.display = 'none';
      }
    }

    // Drafts functionality
    function saveDraft() {
      const postText = postInput.value.trim();
      
      if (postText || selectedMedia.length > 0) {
        // Check if this is an existing draft being edited
        const existingDraftIndex = drafts.findIndex(d => d.isCurrent);
        
        const draft = {
          text: postText,
          media: selectedMedia.map(m => ({
            type: m.type,
            previewUrl: m.previewUrl
          })),
          timestamp: Date.now(),
          isCurrent: true
        };
        
        if (existingDraftIndex !== -1) {
          // Update existing draft
          drafts[existingDraftIndex] = draft;
        } else {
          // Add new draft
          drafts.push(draft);
        }
        
        // Save to localStorage
        localStorage.setItem('postDrafts', JSON.stringify(drafts));
      } else {
        // If no content, remove current draft
        clearCurrentDraft();
      }
    }

    function clearCurrentDraft() {
      // Remove current draft flag from all drafts
      drafts = drafts.filter(d => !d.isCurrent);
      localStorage.setItem('postDrafts', JSON.stringify(drafts));
      renderDrafts();
    }

    function renderDrafts() {
      draftsList.innerHTML = '';
      
      // Filter out current draft (if any)
      const displayDrafts = drafts.filter(d => !d.isCurrent);
      
      if (displayDrafts.length === 0) {
        draftsList.innerHTML = '<div style="color: var(--text-secondary); font-style: italic;">No drafts saved</div>';
        return;
      }
      
      displayDrafts.forEach((draft, index) => {
        const draftItem = document.createElement('div');
        draftItem.className = 'draft-item';
        
        draftItem.innerHTML = `
          <div class="draft-text">${draft.text || '(No text)'}</div>
          <div class="draft-media-count">${draft.media?.length || 0} media files</div>
        `;
        
        draftItem.addEventListener('click', () => loadDraft(index));
        draftsList.appendChild(draftItem);
      });
    }

    function loadDraft(index) {
      // Clear current media (revoke URLs)
      selectedMedia.forEach(m => URL.revokeObjectURL(m.previewUrl));
      
      // Load draft
      const draft = drafts[index];
      postInput.value = draft.text || '';
      
      selectedMedia = (draft.media || []).map(m => ({
        type: m.type,
        previewUrl: m.previewUrl,
        file: null // File object not preserved in draft
      }));
      
      updateMediaPreview();
      updatePostButtonState();
      
      // Mark this as current draft
      drafts[index].isCurrent = true;
      localStorage.setItem('postDrafts', JSON.stringify(drafts));
    }

    function toggleDraftsVisibility() {
      draftsVisible = !draftsVisible;
      draftsList.classList.toggle('show', draftsVisible);
      toggleDrafts.querySelector('span').textContent = draftsVisible ? 'Hide' : 'Show';
      
      // Rotate arrow icon
      const arrow = toggleDrafts.querySelector('svg');
      arrow.style.transform = draftsVisible ? 'rotate(180deg)' : 'rotate(0)';
    }

    // Initialize the app
    init();
</script>

</body>
</html>