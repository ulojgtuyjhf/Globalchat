<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Social Connections</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  }
  
  body {
    background-color: #ffffff;
    color: #0f1419;
    min-height: 100vh;
    width: 100%;
    overflow-y: auto;
  }
  
  .container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
  }
  
  /* Profile Section with Twitter-like hover animation */
  .profile-section {
    display: flex;
    align-items: center;
    padding: 16px;
    background-color: #fff;
    border-radius: 16px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    margin-bottom: 20px;
    border: 1px solid #e6ecf0;
    justify-content: space-between;
    position: relative;
    transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
  }
  
  .profile-section:hover {
    background-color: #f7f7f7;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transform: translateY(-1px);
  }
  
  .profile-section:active {
    background-color: #f0f0f0;
    transform: translateY(0);
  }
  
  .profile-left {
    display: flex;
    align-items: center;
  }
  
  .profile-pic {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 16px;
    border: 2px solid #ffffff;
    display: none;
    transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1);
  }
  
  .profile-pic:hover {
    transform: scale(1.05);
  }
  
  .profile-info {
    display: flex;
    flex-direction: column;
  }
  
  .profile-name {
    font-weight: 800;
    font-size: 18px;
    display: none;
    color: #0f1419;
    transition: color 0.2s ease;
  }
  
  .profile-section:hover .profile-name {
    color: #333;
  }
  
  /* Switch Button with refined animation */
  .switch-btn {
    background-color: #f7f9fa;
    color: #0f1419;
    border: 1px solid #cfd9de;
    border-radius: 20px;
    padding: 8px 16px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
    opacity: 0;
    animation: slideFadeIn 0.6s cubic-bezier(0.2, 0, 0, 1) forwards;
  }
  
  .switch-btn:hover {
    background-color: #e6ecf0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  
  .switch-btn:active {
    background-color: #e0e6eb;
    transform: scale(0.98);
  }
  
  @keyframes slideFadeIn {
    from {
      opacity: 0;
      transform: translateX(12px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  /* Loading Spinner */
  .spinner-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px 0;
  }
  
  .loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(98, 98, 98, 0.1);
    border-radius: 50%;
    border-top-color: #626262;
    animation: spin 1.2s cubic-bezier(0.5, 0.1, 0.4, 0.9) infinite;
    vertical-align: middle;
    margin-right: 8px;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  /* Section Titles with subtle animation */
  .section-title {
    font-size: 18px;
    font-weight: 800;
    margin: 20px 0 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #e6ecf0;
    color: #0f1419;
    position: relative;
  }
  
  .section-title::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 0;
    height: 2px;
    background-color: #626262;
    transition: width 0.3s ease;
  }
  
  .section-title:hover::after {
    width: 40px;
  }
  
  /* User Card with Twitter-like interaction */
  .user-card {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    border-radius: 12px;
    margin-bottom: 8px;
    transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
    border: 1px solid transparent;
  }
  
  .user-card:hover {
    background-color: #f7f7f7;
    border-color: #e6ecf0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    transform: translateY(-1px);
  }
  
  .user-card:active {
    background-color: #f0f0f0;
    transform: translateY(0);
  }
  
  .fade-in {
    opacity: 0;
    animation: fadeIn 0.4s cubic-bezier(0.2, 0, 0, 1) forwards;
  }
  
  @keyframes fadeIn {
    to { opacity: 1; }
  }
  
  .user-pic {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 12px;
    border: 1px solid #e6ecf0;
    transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
  }
  
  .user-card:hover .user-pic {
    transform: scale(1.03);
    border-color: #d6dde3;
  }
  
  .user-info {
    flex: 1;
  }
  
  .user-name {
    font-weight: 700;
    font-size: 15px;
    margin-bottom: 2px;
    color: #0f1419;
    transition: color 0.2s ease;
  }
  
  .user-card:hover .user-name {
    color: #333;
  }
  
  /* Follow Button with enhanced interaction */
  .follow-btn {
    background-color: transparent;
    color: #626262;
    border: 1px solid #626262;
    border-radius: 9999px;
    padding: 6px 16px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.2, 0, 0, 1);
    position: relative;
    overflow: hidden;
  }
  
  .follow-btn:hover {
    background-color: rgba(98, 98, 98, 0.08);
    border-color: #525252;
  }
  
  .follow-btn.followed {
    background: linear-gradient(
      135deg,  
      #0f0f0f 0%,  
      #1c1c1c 15%,  
      #3a3a3a 30%,  
      #4d4d4d 45%,  
      #626262 60%,  
      #787878 75%,  
      #8f8f8f 90%,  
      #a6a6a6 100%
    );
    color: white;
    border: 1px solid transparent;
  }
  
  .follow-btn.followed:hover {
    opacity: 0.92;
    transform: translateY(-1px);
  }
  
  .follow-btn.followed:active {
    transform: translateY(0);
  }
  
  /* Show More Button with Twitter-like animation */
  .show-more {
    text-align: center;
    padding: 12px;
    color: #626262;
    font-weight: 700;
    cursor: pointer;
    margin-top: 12px;
    border-radius: 12px;
    background-color: #fff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    border: 1px solid #e6ecf0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    transition: all 0.25s cubic-bezier(0.2, 0, 0, 1);
    position: relative;
    overflow: hidden;
  }
  
  .show-more:hover {
    background-color: #f7f7f7;
    color: #333;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transform: translateY(-1px);
  }
  
  .show-more:active {
    background-color: #f0f0f0;
    transform: translateY(0);
  }
  
  .show-more::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      to right,
      transparent,
      rgba(255,255,255,0.3),
      transparent
    );
    transform: translateX(-100%);
    transition: transform 0.6s ease;
  }
  
  .show-more:hover::after {
    transform: translateX(100%);
  }
  
  /* Responsive adjustments */
  @media (max-width: 600px) {
    .container {
      padding: 16px;
    }
    .profile-section {
      padding: 14px;
    }
    .profile-pic {
      width: 52px;
      height: 52px;
      margin-right: 14px;
    }
    .switch-btn {
      padding: 7px 14px;
      font-size: 13px;
    }
    .user-card {
      padding: 10px 14px;
    }
    .user-pic {
      width: 44px;
      height: 44px;
    }
    .follow-btn {
      padding: 5px 14px;
      font-size: 13px;
    }
  }
</style>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container">
    <!-- Profile Section with Switch Button -->
    <div class="profile-section">
      <div class="profile-left">
        <div id="profileSpinner" class="loading-spinner" style="margin-right: 15px;"></div>
        <img src="" class="profile-pic" id="myProfilePic" alt="Profile Picture">
        <div class="profile-info">
          <div class="profile-name" id="myProfileName"></div>
        </div>
      </div>
      <button class="switch-btn">Switch</button>
    </div>
    
    <!-- Suggested Users Section -->
    <div class="section-title">Suggested for you</div>
    <div id="suggestedUsersContainer">
      <div id="suggestedSpinner" class="spinner-container">
        <div class="loading-spinner"></div>
      </div>
    </div>
    <div class="show-more" id="showMoreSuggested">
      <span id="suggestedBtnSpinner" class="loading-spinner" style="display: none;"></span>
      Show more
    </div>
    
    <!-- Top Followed Section -->
    <div id="topFollowedSection">
      <div class="section-title">Top followed</div>
      <div id="topFollowedUsersContainer">
        <div id="topFollowedSpinner" class="spinner-container">
          <div class="loading-spinner"></div>
        </div>
      </div>
      <div class="show-more" id="showMoreTopFollowed">
        <span id="topFollowedBtnSpinner" class="loading-spinner" style="display: none;"></span>
        Show more
      </div>
    </div>
  </div>
  
  <script>
    // Global arrays to hold the ordered lists
    let suggestedUsersOrdered = [];
    let topFollowedOrdered = [];
    
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDnPz8BWCaXJOazlFVO4Eap8VxdSR2oDFQ",
      authDomain: "globalchat-2d669.firebaseapp.com",
      projectId: "globalchat-2d669",
      messagingSenderId: "178714711978",
      appId: "1:178714711978:web:fb831188be23e62a4bbdd3"
    };
    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // DOM Elements
    const myProfilePic = document.getElementById('myProfilePic');
    const myProfileName = document.getElementById('myProfileName');
    const profileSpinner = document.getElementById('profileSpinner');
    
    const suggestedUsersContainer = document.getElementById('suggestedUsersContainer');
    const suggestedSpinner = document.getElementById('suggestedSpinner');
    const showMoreSuggested = document.getElementById('showMoreSuggested');
    const suggestedBtnSpinner = document.getElementById('suggestedBtnSpinner');
    
    const topFollowedUsersContainer = document.getElementById('topFollowedUsersContainer');
    const topFollowedSpinner = document.getElementById('topFollowedSpinner');
    const topFollowedSection = document.getElementById('topFollowedSection');
    const showMoreTopFollowed = document.getElementById('showMoreTopFollowed');
    const topFollowedBtnSpinner = document.getElementById('topFollowedBtnSpinner');
    
    // App State
    let currentUser = null;
    let allUsers = [];
    let suggestedUsers = [];   // currently displayed in Suggested section
    let topFollowedUsers = []; // currently displayed in Top Followed section
    const usersPerPage = 5;
    
    // Helper: Shuffle array (Fisher–Yates)
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    // Initialize the app
    function initApp() {
      auth.onAuthStateChanged(async (user) => {
        if (user) {
          try {
            const userDoc = await db.collection('users').doc(user.uid).get();
            currentUser = {
              uid: user.uid,
              displayName: user.displayName || userDoc.data()?.displayName || "User" + Math.floor(Math.random() * 10000),
              photoURL: user.photoURL || userDoc.data()?.photoURL || "https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png"
            };
            myProfilePic.src = currentUser.photoURL;
            myProfilePic.style.display = 'block';
            myProfileName.textContent = currentUser.displayName;
            myProfileName.style.display = 'block';
            profileSpinner.style.display = 'none';
            await loadAllUsers();
            // Compute ordered array for Suggested
            suggestedUsersOrdered = shuffle([...allUsers]);
            suggestedUsers = suggestedUsersOrdered.slice(0, usersPerPage);
            renderUsers(suggestedUsers, suggestedUsersContainer, false);
            
            // Compute ordered array for Top Followed
            topFollowedOrdered = allUsers.filter(user => user.followersCount > 2)
                                         .sort((a, b) => b.followersCount - a.followersCount);
            topFollowedUsers = topFollowedOrdered.slice(0, usersPerPage);
            if (topFollowedUsers.length > 0) {
              renderUsers(topFollowedUsers, topFollowedUsersContainer, false);
            } else {
              topFollowedSection.style.display = 'none';
            }
          } catch (error) {
            console.error('Error initializing user:', error);
          }
        } else {
          auth.signInAnonymously().catch((error) => {
            console.error('Anonymous auth error:', error);
          });
        }
      });
      showMoreSuggested.addEventListener('click', () => loadMoreUsers('suggested'));
      showMoreTopFollowed.addEventListener('click', () => loadMoreUsers('topFollowed'));
    }
    
    async function loadAllUsers() {
      try {
        const usersSnapshot = await db.collection('users').get();
        allUsers = [];
        usersSnapshot.forEach(doc => {
          if (doc.id !== currentUser.uid) {
            const userData = doc.data();
            allUsers.push({
              id: doc.id,
              name: userData.displayName || 'Anonymous',
              photoURL: userData.photoURL || "https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png",
              followersCount: userData.followersCount || 0
            });
          }
        });
        if (allUsers.length === 0) {
          allUsers = [
            { id: 'user_123', name: 'Alex Johnson', photoURL: 'https://randomuser.me/api/portraits/men/32.jpg', followersCount: 3 },
            { id: 'user_456', name: 'Maria Garcia', photoURL: 'https://randomuser.me/api/portraits/women/44.jpg', followersCount: 5 },
            { id: 'user_789', name: 'James Wilson', photoURL: 'https://randomuser.me/api/portraits/men/22.jpg', followersCount: 2 },
            { id: 'user_101', name: 'Sarah Miller', photoURL: 'https://randomuser.me/api/portraits/women/33.jpg', followersCount: 7 },
            { id: 'user_112', name: 'David Taylor', photoURL: 'https://randomuser.me/api/portraits/men/45.jpg', followersCount: 1 }
          ];
        }
      } catch (error) {
        console.error('Error loading users:', error);
        throw error;
      }
    }
    
    async function loadMoreUsers(type) {
      const container = type === 'suggested' ? suggestedUsersContainer : topFollowedUsersContainer;
      const btnSpinner = type === 'suggested' ? suggestedBtnSpinner : topFollowedBtnSpinner;
      try {
        btnSpinner.style.display = 'inline-block';
        let moreUsers = [];
        if (type === 'suggested') {
          moreUsers = suggestedUsersOrdered.slice(suggestedUsers.length, suggestedUsers.length + usersPerPage);
          suggestedUsers = suggestedUsers.concat(moreUsers);
        } else {
          moreUsers = topFollowedOrdered.slice(topFollowedUsers.length, topFollowedUsers.length + usersPerPage);
          topFollowedUsers = topFollowedUsers.concat(moreUsers);
        }
        renderUsers(moreUsers, container, true);
        btnSpinner.style.display = 'none';
        // If no more users, hide the "Show more" button
        if (moreUsers.length < usersPerPage) {
          if (type === 'suggested') {
            showMoreSuggested.style.display = 'none';
          } else {
            showMoreTopFollowed.style.display = 'none';
          }
        }
      } catch (error) {
        console.error(`Error loading more ${type} users:`, error);
        btnSpinner.style.display = 'none';
        if (type === 'suggested') {
          showMoreSuggested.style.display = 'none';
        } else {
          showMoreTopFollowed.style.display = 'none';
        }
      }
    }
    
    // Render users; if appending, apply fade-in effect
    function renderUsers(users, container, append = false) {
      if (!append) {
        container.innerHTML = '';
      }
      if (users.length === 0) {
        container.innerHTML = '<div class="empty-state">No users found</div>';
        return;
      }
      users.forEach(user => {
        const userCard = document.createElement('div');
        userCard.className = 'user-card';
        if (append) {
          userCard.classList.add('fade-in');
        }
        userCard.innerHTML = `
          <img src="${user.photoURL}" class="user-pic" alt="${user.name}">
          <div class="user-info">
            <div class="user-name">${user.name}</div>
          </div>
          <button class="follow-btn" data-user-id="${user.id}" onclick="toggleFollow('${user.id}', '${user.name}', this)">
            Follow
          </button>
        `;
        container.appendChild(userCard);
      });
    }
    
    // Toggle follow/unfollow with loading spinner inside button
    window.toggleFollow = async function(userId, userName, button) {
      if (!currentUser) {
        alert('Please log in to follow users');
        return;
      }
      try {
        button.disabled = true;
        button.innerHTML = '<span class="loading-spinner"></span>';
        const followQuery = db.collection('follows')
          .where('followerUserId', '==', currentUser.uid)
          .where('followedUserId', '==', userId);
        const followSnapshot = await followQuery.get();
        if (followSnapshot.empty) {
          await db.collection('follows').add({
            followerUserId: currentUser.uid,
            followedUserId: userId,
            followedUserName: userName,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });
          setTimeout(() => {
            button.innerHTML = 'Following';
            button.classList.add('followed');
            button.disabled = false;
          }, 500);
        } else {
          followSnapshot.forEach(async (doc) => {
            await db.collection('follows').doc(doc.id).delete();
          });
          setTimeout(() => {
            button.innerHTML = 'Follow';
            button.classList.remove('followed');
            button.disabled = false;
          }, 500);
        }
      } catch (error) {
        console.error('Follow/Unfollow error:', error);
        button.disabled = false;
        button.innerHTML = 'Follow';
      }
    };
    
    window.addEventListener('DOMContentLoaded', initApp);
  </script>
  
</body>
</html>