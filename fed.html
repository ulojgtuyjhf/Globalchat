
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Explore Links</title>
  <style>
    /* Base Reset & Typography */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    :root {
        --primary-color: #1DA1F2; /* Twitter blue */
        --primary-light: #E8F5FE;
        --primary-dark: #0C7ABF;
        --text-primary: #14171A;
        --text-secondary: #657786;
        --background-light: #F5F8FA;
        --background-white: #ffffff;
        --border-light: #E1E8ED;
        --border-radius-sm: 4px;
        --border-radius-md: 12px;
        --border-radius-lg: 9999px;
        --transition-speed: 0.25s;
        --box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        --bubble-color: #DCF8C6; /* WhatsApp message bubble color */
        --bubble-color-self: #E2F3FB; /* Custom blue bubble color */
    }

    html, body {
        height: 100%;
        font-size: 15px;
        color: var(--text-primary);
        background-color: var(--background-light);
    }

    body {
        display: flex;
        flex-direction: column;
    }

    /* Search bar - Twitter style with enhanced blue */
    .search-container {
        position: sticky;
        top: 0;
        z-index: 10;
        background-color: var(--background-white);
        padding: 12px 16px;
        border-bottom: 1px solid var(--border-light);
        display: flex;
        flex-direction: column;
        box-shadow: 0 2px 5px rgba(29, 161, 242, 0.1);
    }

    .search-wrapper {
        position: relative;
        width: 100%;
    }

    .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary-color);
        pointer-events: none;
    }

    .search-bar {
        width: 100%;
        padding: 12px 16px 12px 42px;
        border-radius: var(--border-radius-lg);
        border: 1px solid var(--border-light);
        background-color: #EFF3F4;
        font-size: 0.95rem;
        color: var(--text-primary);
        transition: all 0.3s ease;
        box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
    }

    .search-bar:focus {
        outline: none;
        background-color: var(--background-white);
        border-color: var(--primary-color);
        box-shadow: 0 0 0 1px var(--primary-color), 0 0 0 4px rgba(29, 161, 242, 0.1);
    }

    .search-bar::placeholder {
        color: var(--text-secondary);
    }

    /* Search assistant */
    .search-assistant {
        margin-top: 8px;
        font-size: 0.85rem;
        color: var(--primary-color);
        display: none;
        animation: fadeIn 0.3s ease;
        font-weight: 500;
    }

    .assistant-active {
        display: block;
    }

    /* Links container */
    .links-container {
        flex: 1;
        overflow-y: auto;
        padding: 0;
        scrollbar-width: thin;
        scrollbar-color: var(--text-secondary) var(--background-light);
        scroll-behavior: smooth;
    }

    .links-container::-webkit-scrollbar {
        width: 4px;
    }

    .links-container::-webkit-scrollbar-track {
        background: var(--background-light);
    }

    .links-container::-webkit-scrollbar-thumb {
        background: var(--primary-color);
        border-radius: 2px;
    }

    /* Link Item - WhatsApp Style Bubbles */
    .link-item {
        padding: 8px 16px;
        position: relative;
        transition: background-color 0.2s ease;
        animation: slideIn 0.3s ease forwards;
        opacity: 0;
        transform: translateY(20px);
        display: flex;
        margin-bottom: 8px;
    }
    
    @keyframes slideIn {
        to { 
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .profile-image {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        margin-right: 12px;
        flex-shrink: 0;
        object-fit: cover;
        border: 1px solid var(--border-light);
        transition: transform 0.3s ease;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .profile-image:hover {
        transform: scale(1.05);
    }

    /* WhatsApp Style Message Bubble */
    .message-bubble {
        background-color: var(--bubble-color-self);
        border-radius: 12px 12px 12px 0;
        padding: 12px 16px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        position: relative;
        max-width: calc(100% - 60px);
        flex: 1;
    }

    /* Bubble arrow */
    .message-bubble:before {
        content: "";
        position: absolute;
        left: -8px;
        bottom: 0;
        width: 0;
        height: 0;
        border: 8px solid transparent;
        border-right-color: var(--bubble-color-self);
        border-left: 0;
        border-bottom: 0;
    }

    .user-info {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
    }

    .user-name {
        font-weight: 700;
        color: var(--text-primary);
        margin-right: 4px;
    }

    .user-handle, .timestamp {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .timestamp {
        margin-left: auto;
        font-size: 0.8rem;
    }

    .link-url {
        color: var(--primary-dark);
        text-decoration: none;
        word-break: break-word;
        margin-bottom: 8px;
        display: block;
        line-height: 1.4;
        transition: color 0.2s ease;
        font-weight: 500;
    }
    
    .link-url:hover {
        text-decoration: underline;
    }

    /* Social Media Platform Tags */
    .platform-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 8px;
    }

    .platform-tag {
        display: inline-flex;
        align-items: center;
        background-color: rgba(29, 161, 242, 0.1);
        color: var(--primary-color);
        border-radius: var(--border-radius-lg);
        padding: 3px 10px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .platform-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 6px;
        width: 16px;
        height: 16px;
    }

    /* Highlight for search matches */
    .highlight {
        background-color: rgba(255, 230, 0, 0.2);
        font-weight: 600;
        border-radius: 2px;
        padding: 0 2px;
    }

    /* Loading animation */
    .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100px;
        flex-direction: column;
    }

    .spinner {
        width: 24px;
        height: 24px;
        border: 2px solid rgba(29, 161, 242, 0.2);
        border-top: 2px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loading-text {
        margin-top: 12px;
        color: var(--primary-color);
        font-size: 0.9rem;
        font-weight: 500;
    }

    /* No links message */
    .no-links {
        text-align: center;
        padding: 30px;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .profile-image {
            width: 40px;
            height: 40px;
        }
        
        .message-bubble {
            max-width: calc(100% - 52px);
        }
    }

    @media (max-width: 576px) {
        .search-bar {
            padding: 10px 12px 10px 38px;
        }
        
        .search-icon {
            left: 12px;
        }
        
        .link-item {
            padding: 8px 10px;
        }
        
        .profile-image {
            width: 36px;
            height: 36px;
        }
        
        .message-bubble {
            padding: 10px 12px;
            max-width: calc(100% - 46px);
        }
    }
  </style>
</head>
<body>
  <div class="search-container">
    <div class="search-wrapper">
      <div class="search-icon">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
          <path d="M21.53 20.47l-3.66-3.66C19.195 15.24 20 13.214 20 11c0-4.97-4.03-9-9-9s-9 4.03-9 9 4.03 9 9 9c2.215 0 4.24-.804 5.808-2.13l3.66 3.66c.147.146.34.22.53.22s.385-.073.53-.22c.295-.293.295-.767.002-1.06zM3.5 11c0-4.135 3.365-7.5 7.5-7.5s7.5 3.365 7.5 7.5-3.365 7.5-7.5 7.5-7.5-3.365-7.5-7.5z"></path>
        </svg>
      </div>
      <input type="text" class="search-bar" id="searchBar" placeholder="Search links..." autocomplete="off">
    </div>
    <div class="search-assistant" id="searchAssistant">
      Try searching for a social platform or keyword
    </div>
  </div>
  
  <div class="links-container" id="linksContainer">
    <div class="loading-container" id="loadingIndicator">
      <div class="spinner"></div>
      <div class="loading-text">Loading links...</div>
    </div>
  </div>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onChildAdded, get, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDnPz8BWCaXJOazlFVO4Eap8VxdSR2oDFQ",
      authDomain: "globalchat-2d669.firebaseapp.com",
      projectId: "globalchat-2d669",
      storageBucket: "globalchat-2d669.appspot.com",
      messagingSenderId: "178714711978",
      appId: "1:178714711978:web:fb831188be23e62a4bbdd3",
      databaseURL: "https://globalchat-2d669-default-rtdb.firebaseio.com/",
      storageBucket: "globalchat-2d669.appspot.com"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);
    const messagesRef = ref(database, 'messages');
    const linksContainer = document.getElementById('linksContainer');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const searchBar = document.getElementById('searchBar');
    const searchAssistant = document.getElementById('searchAssistant');
    
    // Track displayed links to prevent duplicates
    const displayedLinks = new Set();
    let allLinks = [];
    
    // Social media platforms with professional SVG icons
    const socialMediaPlatforms = [
      { 
        domain: 'twitter.com', 
        name: 'Twitter', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#1DA1F2"><path d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"></path></svg>'
      },
      { 
        domain: 'x.com', 
        name: 'X', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#000000"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>'
      },
      { 
        domain: 'instagram.com', 
        name: 'Instagram', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#E4405F"><path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.897 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.897-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"></path></svg>'
      },
      { 
        domain: 'facebook.com', 
        name: 'Facebook', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#1877F2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg>'
      },
      { 
        domain: 'tiktok.com', 
        name: 'TikTok', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#000000"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"></path></svg>'
      },
      { 
        domain: 'youtube.com', 
        name: 'YouTube', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#FF0000"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg>'
      },
      { 
        domain: 'linkedin.com', 
        name: 'LinkedIn', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#0A66C2"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg>'
      },
      { 
        domain: 'pinterest.com', 
        name: 'Pinterest', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#E60023"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"></path></svg>'
      },
      
      { 
        domain: 'reddit.com', 
        name: 'Reddit', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#FF4500"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-1.248 3.494c-.745 0-1.346.611-1.346 1.354 0 .744.602 1.354 1.346 1.354.744 0 1.346-.61 1.346-1.354 0-.744-.602-1.354-1.346-1.354z"></path></svg>'
      },
      { 
        domain: 'snapchat.com', 
        name: 'Snapchat', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#FFFC00"><path d="M12.206.793c.99 0 4.347.276 5.93 3.821.529 1.193.403 3.219.299 4.847l-.003.06c-.012.18-.022.345-.03.51.075.045.203.09.401.09.3-.016.659-.12 1.033-.301.165-.088.344-.104.464-.104.182 0 .359.029.509.09.45.149.734.479.734.838.015.449-.39.839-1.213 1.168-.089.029-.209.075-.344.119-.45.135-1.139.36-1.333.81-.09.224-.061.524.12.868l.015.015c.06.136 1.526 3.475 4.791 4.014.255.044.435.27.42.509 0 .075-.015.149-.045.225-.24.359-1.275.975-3.225 1.125-.046.193-.076.389-.105.479-.044.15-.091.3-.135.449-.089.224-.209.39-.344.39-.09 0-.18-.044-.24-.119-.15-.15-.39-.39-1.364-.39-.61 0-1.319.089-2.159.255-.84.18-1.649.57-2.609.571-1.019 0-1.845-.39-2.645-.585-.779-.18-1.469-.255-2.084-.255-.96 0-1.215.24-1.35.391-.057.074-.149.119-.239.119-.15 0-.256-.18-.346-.405-.044-.149-.09-.298-.135-.449-.029-.09-.059-.286-.104-.479-1.939-.149-2.973-.765-3.224-1.125-.029-.074-.044-.149-.044-.225-.015-.239.165-.464.42-.509 3.264-.54 4.73-3.879 4.8-4.02l.016-.029c.18-.345.224-.645.119-.869-.195-.435-.884-.66-1.334-.795-.119-.03-.24-.074-.344-.105-1.049-.435-1.124-.96-1.064-1.215.06-.149.149-.285.374-.285.104 0 .226.03.375.09.255.149.584.255.958.271.225.015.452-.03.661-.119-.029-.254-.059-.554-.074-.899-.061-1.664-.165-3.729.318-4.95C7.683 1.004 11.072.793 12.007.793h.199z"></path></svg>'
      },
      { 
        domain: 'threads.net', 
        name: 'Threads', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#000000"><path d="M19.57 7.37c-1.5-1.47-3.9-1.54-5.32-1.4-.23-.82-.63-1.52-1.23-2.12-1.75-1.77-4.58-1.83-6.4-.13-.42.4-.7.85-.88 1.35-2.22.12-3.88 1.72-4.18 3.72-.1.71.02 1.4.23 2.03-.19.73-.08 1.58.28 2.35.86 1.83 2.92 2.93 4.85 2.93 3.47 0 5.33-2.29 5.32-4.54 0-.78-.22-1.65-.83-2.35 0 0 1.32-.99 2.13.08.38.5.33 1.52.33 2.11 0 2.58-1.78 5.74-5.87 5.74-3.87 0-6.87-3.06-6.87-6.93 0-3.82 3.02-6.82 6.84-6.88.13 0 .27 0 .4.02 1.47.06 2.84.56 3.99 1.4.39.28.82.53 1.25.7 1.78.72 3.02-.18 3.52-.78.71-.83 1.03-2.15-.55-3.3zM9.32 12.4v-.04c0 1.5-1.2 2.71-2.7 2.71S3.92 13.86 3.92 12.36s1.2-2.71 2.7-2.71c.81 0 1.51.35 2 .92.5.57.7 1.14.7 1.83z"></path></svg>'
      },
      { 
        domain: 'discord.com', 
        name: 'Discord', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#5865F2"><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"></path></svg>'
      },
      { 
        domain: 'twitch.tv', 
        name: 'Twitch', 
        icon: '<svg viewBox="0 0 24 24" width="16" height="16" fill="#9146FF"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z"></path></svg>'
      }
    ];
    
    // URL regex pattern for detecting links
    const urlPattern = /(https?:\/\/[^\s]+)|(www\.[^\s]+)|([a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}(\.[a-zA-Z]{2,})?\/[^\s]+)/gi;

    // Format timestamp - Twitter style
    function formatTimestamp(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diffInHours = Math.floor((now - date) / (1000 * 60 * 60));
      const diffInDays = Math.floor(diffInHours / 24);
      
      if (diffInHours < 1) {
        const diffInMinutes = Math.floor((now - date) / (1000 * 60));
        return `${diffInMinutes}m`;
      } else if (diffInHours < 24) {
        return `${diffInHours}h`;
      } else if (diffInDays < 7) {
        return `${diffInDays}d`;
      } else {
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        return `${months[date.getMonth()]} ${date.getDate()}`;
      }
    }

    // Extract URLs from text
    function extractUrls(text) {
      if (!text) return [];
      
      const matches = text.match(urlPattern);
      return matches ? matches : [];
    }

    // Format URL for display
    function formatUrl(url) {
      // Add https:// if missing and url starts with www.
      if (url.startsWith('www.')) {
        url = 'https://' + url;
      }
      
      // If it doesn't have a protocol but has a domain structure, add https://
      if (!url.startsWith('http://') && !url.startsWith('https://') && 
          /^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}/.test(url)) {
        url = 'https://' + url;
      }
      
      return url;
    }
    
    // Identify which social media platform a URL belongs to
    function identifySocialMedia(url) {
      const lowerUrl = url.toLowerCase();
      
      for (const platform of socialMediaPlatforms) {
        if (lowerUrl.includes(platform.domain)) {
          return platform;
        }
      }
      
      return null;
    }
    
    // Get user handle from name
    function getUserHandle(name) {
      if (!name) return '@user';
      return '@' + name.toLowerCase().replace(/\s+/g, '');
    }
    
    // Highlight search terms in text
    function highlightText(text, searchTerm) {
      if (!searchTerm) return text;
      
      const regex = new RegExp(searchTerm, 'gi');
      return text.replace(regex, match => `<span class="highlight">${match}</span>`);
    }
    
    // Create link element with WhatsApp style bubbles
    function createLinkElement(url, message, searchTerm = '') {
      const formattedUrl = formatUrl(url);
      const socialPlatform = identifySocialMedia(formattedUrl);
      
      // Store link data for searching
      const linkData = {
        url: formattedUrl,
        message: message,
        socialPlatform: socialPlatform,
        element: null
      };
      
      const linkElement = document.createElement('div');
      linkElement.classList.add('link-item');
      
      // Set animation delay for staggered appearance
      const delay = Math.random() * 0.3;
      linkElement.style.animationDelay = `${delay}s`;
      
      const displayUrl = formattedUrl.length > 50 ? 
        formattedUrl.substring(0, 47) + '...' : 
        formattedUrl;
      
      const displayName = message.name || 'User';
      const userHandle = getUserHandle(displayName);
      
      // Apply highlighting if search term is provided
      const highlightedUrl = searchTerm ? highlightText(displayUrl, searchTerm) : displayUrl;
      const highlightedName = searchTerm ? highlightText(displayName, searchTerm) : displayName;
      
      // Create platform tags HTML
      let platformTagsHTML = '';
      if (socialPlatform) {
        platformTagsHTML = `
          <div class="platform-tags">
            <span class="platform-tag">
              <span class="platform-icon">${socialPlatform.icon}</span>
              ${socialPlatform.name}
            </span>
          </div>
        `;
      }
      
      linkElement.innerHTML = `
        <img src="${message.photoURL || 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png'}" 
             class="profile-image" alt="Profile">
        <div class="message-bubble">
          <div class="user-info">
            <span class="user-name">${highlightedName}</span>
            <span class="user-handle">${userHandle}</span>
            <span class="timestamp">${formatTimestamp(message.timestamp)}</span>
          </div>
          <a href="${formattedUrl}" class="link-url" target="_blank" rel="noopener noreferrer">${highlightedUrl}</a>
          ${platformTagsHTML}
        </div>
      `;
      
      linkData.element = linkElement;
      return linkData;
    }
    
    // Filter links based on search term
    function filterLinks(searchTerm) {
      if (!searchTerm.trim()) {
        // If search is empty, show all links
        return allLinks;
      }
      
      searchTerm = searchTerm.toLowerCase();
      return allLinks.filter(link => {
        // Check URL
        if (link.url.toLowerCase().includes(searchTerm)) return true;
        
        // Check user name
        if (link.message.name && link.message.name.toLowerCase().includes(searchTerm)) return true;
        
        // Check social platform
        if (link.socialPlatform && 
           (link.socialPlatform.name.toLowerCase().includes(searchTerm) || 
            link.socialPlatform.domain.includes(searchTerm))) return true;
        
        return false;
      });
    }
    
    // Display filtered links
    function displayFilteredLinks(filteredLinks, searchTerm = '') {
      linksContainer.innerHTML = '';
      
      if (filteredLinks.length === 0) {
        showNoLinksMessage();
        return;
      }
      
      // Sort by timestamp (newest first)
      filteredLinks.sort((a, b) => b.message.timestamp - a.message.timestamp);
      
      // Create new elements with highlighting
      filteredLinks.forEach(linkData => {
        const newElement = createLinkElement(linkData.url, linkData.message, searchTerm).element;
        linksContainer.appendChild(newElement);
      });
    }
    
    // Update search assistant
    function updateSearchAssistant(searchTerm) {
      if (!searchTerm.trim()) {
        searchAssistant.classList.remove('assistant-active');
        return;
      }
      
      searchAssistant.classList.add('assistant-active');
      
      // Count matches
      const filteredLinks = filterLinks(searchTerm);
      
      if (filteredLinks.length > 0) {
        searchAssistant.textContent = `Found ${filteredLinks.length} matching links`;
      } else {
        searchAssistant.textContent = `No matches found for "${searchTerm}"`;
      }
    }

    // Initialize link feed
    function initLinkFeed() {
      // Add beautiful search animation
      searchBar.addEventListener('focus', function() {
        this.parentElement.style.transform = 'scale(1.02)';
        this.parentElement.style.transition = 'transform 0.3s ease';
      });
      
      searchBar.addEventListener('blur', function() {
        this.parentElement.style.transform = 'scale(1)';
      });
      
      // Initialize search functionality
      searchBar.addEventListener('input', function() {
        const searchTerm = this.value.trim();
        updateSearchAssistant(searchTerm);
        
        // Show loading spinner for better UX on search
        if (searchTerm) {
          linksContainer.innerHTML = '';
          const loadingContainer = document.createElement('div');
          loadingContainer.classList.add('loading-container');
          loadingContainer.innerHTML = `
            <div class="spinner"></div>
            <div class="loading-text">Searching...</div>
          `;
          linksContainer.appendChild(loadingContainer);
          
          // Small delay to show the spinner (feels more responsive)
          setTimeout(() => {
            const filteredLinks = filterLinks(searchTerm);
            displayFilteredLinks(filteredLinks, searchTerm);
          }, 300);
        } else {
          displayFilteredLinks(allLinks);
        }
      });
      
      // Sign in anonymously
      signInAnonymously(auth).catch((error) => {
        console.error('Anonymous auth error:', error);
        loadingIndicator.style.display = 'none';
        showNoLinksMessage('Could not connect to the server');
      });
      
      // Query to get last 100 messages
      const messagesQuery = query(messagesRef, limitToLast(100));
      
      // Initial load of existing messages
      get(messagesQuery).then((snapshot) => {
        loadingIndicator.style.display = 'none';
        
        if (snapshot.exists()) {
          const messages = snapshot.val();
          
          // Process messages to extract social media links
          Object.keys(messages).forEach(key => {
            const message = messages[key];
            const urls = extractUrls(message.text);
            
            // Store each social media URL
            urls.forEach(url => {
              const formattedUrl = formatUrl(url);
              
              // Skip if already displayed
              if (displayedLinks.has(formattedUrl)) {
                return;
              }
              
              // Add to displayed links set
              displayedLinks.add(formattedUrl);
              
              // Check if it's a social media link
              const socialPlatform = identifySocialMedia(formattedUrl);
              if (socialPlatform) {
                const linkData = createLinkElement(url, message);
                allLinks.push(linkData);
              }
            });
          });
          
          // Sort and display links (newest first)
          allLinks.sort((a, b) => b.message.timestamp - a.message.timestamp);
          
          if (allLinks.length > 0) {
            allLinks.forEach(link => {
              linksContainer.appendChild(link.element);
            });
          } else {
            showNoLinksMessage();
          }
        } else {
          showNoLinksMessage();
        }
      }).catch((error) => {
        console.error('Error fetching messages:', error);
        loadingIndicator.style.display = 'none';
        showNoLinksMessage('Error loading links');
      });
      
      // Listen for new messages
      onChildAdded(messagesRef, (snapshot) => {
        const message = snapshot.val();
        const urls = extractUrls(message.text);
        
        // Display each social media URL in the message
        urls.forEach(url => {
          const formattedUrl = formatUrl(url);
          
          // Skip if already displayed
          if (displayedLinks.has(formattedUrl)) {
            return;
          }
          
          // Add to displayed links set
          displayedLinks.add(formattedUrl);
          
          // Check if it's a social media link
          const socialPlatform = identifySocialMedia(formattedUrl);
          if (socialPlatform) {
            const linkData = createLinkElement(url, message);
            allLinks.unshift(linkData); // Add to beginning of array
            
            // Only add to DOM if no search filter is active
            if (!searchBar.value.trim()) {
              linksContainer.prepend(linkData.element);
              
              // Add a highlight animation to new entries
              linkData.element.style.animation = 'none';
              linkData.element.offsetHeight; // Trigger reflow
              linkData.element.style.animation = 'slideIn 0.5s ease forwards, highlight 2s ease';
            }
          }
        });
      });
    }
    
    // Show message when no links are found
    function showNoLinksMessage(message = 'No social media links found') {
      const noLinksMessage = document.createElement('div');
      noLinksMessage.classList.add('no-links');
      noLinksMessage.textContent = message;
      linksContainer.appendChild(noLinksMessage);
    }
    
    // Start the link feed
    initLinkFeed();
  </script>
</body>
</html>
