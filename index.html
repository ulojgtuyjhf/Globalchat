<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Primary Meta Tags -->
    <title>Login - Global Chat Room | Nmedea.com</title>
    <meta name="title" content="Login - Global Chat Room | Nmedea.com">
    <meta name="description" content="Join our global chat community at Nmedea.com. Connect with people worldwide in real-time. Safe, secure, and easy to use chat platform for international communication.">
    
    <!-- Keywords -->
    <meta name="keywords" content="global chat, chat room, online chat, international chat, nmedea chat, secure chat, real-time chat, chat community, social platform">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nmedea.com/login">
    <meta property="og:title" content="Login to Global Chat Room - Nmedea.com">
    <meta property="og:description" content="Connect with people worldwide in our global chat community. Join now for real-time conversations and make friends across borders.">
    <meta property="og:image" content="https://nmedea.com/images/og-image.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://nmedea.com/login">
    <meta property="twitter:title" content="Login to Global Chat Room - Nmedea.com">
    <meta property="twitter:description" content="Connect with people worldwide in our global chat community. Join now for real-time conversations and make friends across borders.">
    <meta property="twitter:image" content="https://nmedea.com/images/twitter-image.jpg">
    
    <!-- Additional SEO Tags -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="Nmedea.com">
    <meta name="language" content="English">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="stylesheet" href="login.css">
    <link rel="icon" type="image/png" href="https://firebasestorage.googleapis.com/v0/b/chatnot-e5b4e.firebasestorage.app/o/Black%20and%20Blue%20Initials%20Creative%20Logo_20250214_091517_0000.png?alt=media&token=e420af56-8bd5-4691-b246-b0485c30dccd">
    
    
    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

     <style>
        
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

:root {
  --primary: #4a90e2;
  --primary-light: rgba(74, 144, 226, 0.1);
  --primary-medium: rgba(74, 144, 226, 0.2);
  --primary-shadow: rgba(74, 144, 226, 0.2);
  --text-dark: #333;
  --text-medium: #555;
  --text-light: #777;
  --background: #f9fafc;
  --card-bg: rgba(255, 255, 255, 0.9);
  --border-color: rgba(200, 200, 200, 0.5);
  --white: #ffffff;
  --error: #e74c3c;
  --border-radius-lg: 16px;
  --border-radius-md: 10px;
  --box-shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
  --box-shadow-md: 0 8px 24px rgba(0, 0, 0, 0.1);
  --box-shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.1);
  --transition-default: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

html, body {
  width: 100%;
  height: 100%;
  overflow-x: hidden;
}

body {
  background-color: var(--background);
  color: var(--text-dark);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.auth-container {
  width: 100%;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  padding: clamp(1rem, 5vw, 2rem);
  background-color: var(--background);
  position: relative;
}

.auth-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at center, rgba(245, 245, 245, 0.7) 0%, rgba(255, 255, 255, 0.9) 70%);
  z-index: 0;
}

.svg-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  opacity: 0.1;
}

.header {
  display: flex;
  align-items: center;
  padding: clamp(0.75rem, 3vw, 1rem);
  position: relative;
  z-index: 2;
  justify-content: center;
}

.logo {
  font-size: clamp(1.8rem, 4vw, 2.2rem);
  font-weight: bold;
  color: var(--primary);
  letter-spacing: 1px;
  animation: fadeInDown 0.8s ease-out;
}

.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
  z-index: 2;
  padding: clamp(1rem, 3vw, 2rem) 0;
}

.auth-options-container {
  width: 100%;
  max-width: 800px;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: var(--transition-default);
}

.welcome-text {
  text-align: center;
  margin-bottom: clamp(1.5rem, 5vw, 2.5rem);
  animation: fadeIn 1s ease-out;
  padding: 0 1rem;
}

.welcome-text h1 {
  font-size: clamp(1.8rem, 5vw, 2.5rem);
  color: var(--text-dark);
  margin-bottom: clamp(0.75rem, 2vw, 1rem);
  font-weight: 700;
}

.welcome-text p {
  font-size: clamp(0.95rem, 2vw, 1.1rem);
  color: var(--text-light);
  max-width: 600px;
  line-height: 1.6;
  margin: 0 auto;
}

.auth-options {
  display: flex;
  gap: clamp(1rem, 3vw, 1.5rem);
  margin-bottom: clamp(1.5rem, 4vw, 2rem);
  justify-content: center;
  flex-wrap: wrap;
  width: 100%;
  animation: fadeIn 1s ease-out 0.3s both;
  padding: 0 clamp(0.5rem, 2vw, 1rem);
}

.auth-option {
  flex: 1;
  min-width: clamp(200px, 40%, 280px);
  max-width: 280px;
  padding: clamp(1.25rem, 3vw, 1.5rem);
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  background-color: var(--card-bg);
  color: var(--text-medium);
  cursor: pointer;
  transition: var(--transition-default);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: clamp(0.75rem, 2vw, 1rem);
  font-weight: 500;
  box-shadow: var(--box-shadow-sm);
  position: relative;
  overflow: hidden;
  text-align: center;
}

.auth-option .icon {
  width: clamp(40px, 10vw, 48px);
  height: clamp(40px, 10vw, 48px);
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--primary-light);
  border-radius: 50%;
  margin-bottom: 0.5rem;
  transition: var(--transition-default);
}

.auth-option .icon svg {
  width: clamp(20px, 5vw, 24px);
  height: clamp(20px, 5vw, 24px);
  color: var(--primary);
}

.auth-option .option-title {
  font-weight: 600;
  font-size: clamp(1rem, 2.5vw, 1.1rem);
  color: var(--text-dark);
}

.auth-option .option-description {
  font-size: clamp(0.85rem, 2vw, 0.9rem);
  color: var(--text-light);
  line-height: 1.4;
}

.auth-option::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 70%);
  transform: translateX(-100%);
}

.auth-option:hover {
  background-color: var(--white);
  border-color: var(--primary);
  transform: translateY(-5px);
  box-shadow: var(--box-shadow-md);
}

.auth-option:hover .icon {
  background-color: var(--primary-medium);
}

.auth-option:hover::after {
  animation: shine 1.5s ease-out;
}

.auth-option:active {
  transform: translateY(-2px);
}

.form-container {
  width: 100%;
  max-width: 450px;
  z-index: 1;
  position: relative;
  display: none;
  animation: fadeIn 0.8s ease-out;
  padding: 0 clamp(1rem, 3vw, 1.5rem);
}

.form-container.active {
  display: block;
}

.auth-form {
  opacity: 0;
  transform: translateY(20px);
  transition: var(--transition-default);
  background-color: var(--white);
  padding: clamp(1.5rem, 4vw, 2rem);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--box-shadow-lg);
  border: 1px solid #eaeaea;
}

.auth-form.active {
  opacity: 1;
  transform: translateY(0);
  animation: slideUp 0.5s ease-out;
}

.form-header {
  margin-bottom: clamp(1.25rem, 3vw, 1.5rem);
  text-align: center;
}

.form-header h2 {
  font-size: clamp(1.5rem, 4vw, 1.8rem);
  color: var(--text-dark);
  margin-bottom: 0.5rem;
}

.form-header p {
  color: var(--text-light);
  font-size: clamp(0.9rem, 2vw, 0.95rem);
}

.input-group {
  margin-bottom: clamp(1.25rem, 3vw, 1.5rem);
  position: relative;
}

.input-group label {
  display: block;
  margin-bottom: 0.5rem;
  color: var(--text-medium);
  font-weight: 500;
  font-size: clamp(0.9rem, 2vw, 0.95rem);
}

.input-group input {
  width: 100%;
  padding: clamp(0.75rem, 2vw, 0.9rem) clamp(0.75rem, 2vw, 1rem);
  border: 2px solid #eaeaea;
  border-radius: var(--border-radius-md);
  background-color: #f9f9f9;
  color: var(--text-dark);
  font-size: clamp(0.95rem, 2vw, 1rem);
  transition: var(--transition-default);
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

.input-group input:focus {
  border-color: var(--primary);
  outline: none;
  background-color: var(--white);
  box-shadow: 0 0 0 3px var(--primary-light);
}

.error-message {
  color: var(--error);
  font-size: clamp(0.8rem, 2vw, 0.85rem);
  margin-top: 0.5rem;
  display: none;
  animation: shake 0.5s ease-out;
}

button {
  width: 100%;
  padding: clamp(0.9rem, 2.5vw, 1rem);
  border: none;
  border-radius: var(--border-radius-md);
  background-color: var(--primary);
  color: var(--white);
  font-size: clamp(0.95rem, 2vw, 1rem);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-default);
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 6px var(--primary-shadow);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

button::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 70%);
  transform: translateX(-100%);
}

button:hover, button:focus {
  background-color: #3a7abd;
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(74, 144, 226, 0.3);
  outline: none;
}

button:hover::after {
  animation: shine 1.5s ease-out;
}

button:active {
  transform: translateY(0);
}

.back-button {
  position: absolute;
  top: 1rem;
  left: 1rem;
  background: transparent;
  border: none;
  color: var(--primary);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  font-weight: 500;
  padding: 0.5rem;
  width: auto;
  box-shadow: none;
  font-size: clamp(0.9rem, 2vw, 1rem);
}

.back-button:hover, .back-button:focus {
  background: transparent;
  transform: translateX(-2px);
  box-shadow: none;
  color: #3a7abd;
}

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(5px);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 100;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition-default);
}

.overlay.active {
  opacity: 1;
  visibility: visible;
  animation: fadeIn 0.3s ease-out;
}

.loader {
  width: clamp(40px, 10vw, 50px);
  height: clamp(40px, 10vw, 50px);
  border-radius: 50%;
  border: 3px solid var(--primary-light);
  border-top-color: var(--primary);
  animation: spin 1s linear infinite;
  margin-bottom: clamp(1.25rem, 3vw, 1.5rem);
  box-shadow: 0 0 10px var(--primary-light);
}

.loader-text {
  color: var(--primary);
  font-size: clamp(1rem, 2.5vw, 1.1rem);
  font-weight: 500;
  text-align: center;
  max-width: 80%;
  animation: pulse 2s infinite;
}

/* Touch device optimizations */
@media (hover: none) {
  .auth-option:hover {
    transform: none;
  }
  
  .auth-option:active {
    background-color: var(--white);
    border-color: var(--primary);
    transform: translateY(-2px);
  }
  
  button:hover {
    transform: none;
  }
  
  button:active {
    background-color: #3a7abd;
    transform: translateY(1px);
  }
}

/* Animations */
@keyframes spin {
  to { transform: rotate(360deg); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-5px); }
  40%, 80% { transform: translateX(5px); }
}

@keyframes shine {
  to { transform: translateX(100%); }
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.7; }
  100% { opacity: 1; }
}

/* Responsive adjustments */
@media (max-width: 480px) {
  .auth-option {
    min-width: 100%;
  }
}

/* Fix for iOS input zoom */
@media screen and (max-width: 768px) {
  input[type="text"],
  input[type="email"],
  input[type="password"] {
    font-size: 16px;
  }
}

/* Fix for notched phones */
@supports (padding: max(0px)) {
  .auth-container {
    padding-left: max(clamp(1rem, 5vw, 2rem), env(safe-area-inset-left));
    padding-right: max(clamp(1rem, 5vw, 2rem), env(safe-area-inset-right));
    padding-bottom: max(clamp(1rem, 5vw, 2rem), env(safe-area-inset-bottom));
  }
}

    </style>
</head>
<body>
    <div class="auth-container">
        <svg class="svg-background" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#eaeaea" stroke-width="0.8" opacity="0.5"/>
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#grid)" />
            <g fill="#4a90e2" opacity="0.05">
                <circle cx="20%" cy="20%" r="100" />
                <circle cx="80%" cy="60%" r="180" />
                <circle cx="50%" cy="85%" r="120" />
                <circle cx="15%" cy="70%" r="60" />
                <circle cx="85%" cy="15%" r="80" />
            </g>
        </svg>
        
        <div class="header">
            <div class="logo">Nmedea</div>
        </div>
        
        <div class="main-content">
            <div class="auth-options-container" id="auth-options-container">
                <div class="welcome-text">
                    <h1>Welcome to Nmedea</h1>
                    <p>Choose your preferred authentication method to join our secure platform.</p>
                </div>
                
                <div class="auth-options">
                    <div class="auth-option" id="auto-auth">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                        </div>
                        <div class="option-title">Semi-Auto Authentication</div>
                        <div class="option-description">We'll generate secure credentials for you. You just choose a username.</div>
                    </div>
                    
                    <div class="auth-option" id="full-auto-auth">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                <circle cx="12" cy="11" r="3"></circle>
                            </svg>
                        </div>
                        <div class="option-title">Full Auto Setup</div>
                        <div class="option-description">One-click authentication. We'll handle everything for you.</div>
                    </div>
                    
                    <div class="auth-option" id="manual-auth">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                        </div>
                        <div class="option-title">Manual Login</div>
                        <div class="option-description">Complete control. Use your own email, password, and username.</div>
                    </div>
                </div>
            </div>
            
            <!-- Username Form (shown after semi-auto auth) -->
            <div class="form-container" id="username-form-container">
                <button class="back-button" id="username-back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    Back
                </button>
                <form class="auth-form active" id="username-form">
                    <div class="form-header">
                        <h2>Choose Your Username</h2>
                        <p>We've automatically created secure credentials for you.</p>
                    </div>
                    <div class="input-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Enter your preferred username">
                        <div class="error-message" id="username-error"></div>
                    </div>
                    <button type="submit" id="start-button">Start Chatting</button>
                </form>
            </div>
            
            <!-- Manual Auth Form -->
            <div class="form-container" id="manual-form-container">
                <button class="back-button" id="manual-back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    Back
                </button>
                <form class="auth-form active" id="manual-form">
                    <div class="form-header">
                        <h2>Manual Authentication</h2>
                        <p>Enter your details to sign in or create a new account.</p>
                    </div>
                    <div class="input-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="Enter your email">
                        <div class="error-message" id="email-error"></div>
                    </div>
                    <div class="input-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter your password">
                        <div class="error-message" id="password-error"></div>
                    </div>
                    <div class="input-group">
                        <label for="login-username">Username</label>
                        <input type="text" id="login-username" placeholder="Choose a username">
                        <div class="error-message" id="login-username-error"></div>
                    </div>
                    <button type="submit" id="login-button">Sign In / Sign Up</button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="overlay" id="overlay">
        <div class="loader"></div>
        <div class="loader-text" id="loader-text">Generating authentication keys...</div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, setDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDnPz8BWCaXJOazlFVO4Eap8VxdSR2oDFQ",
            authDomain: "globalchat-2d669.firebaseapp.com",
            projectId: "globalchat-2d669",
            storageBucket: "globalchat-2d669.firebasestorage.app",
            messagingSenderId: "178714711978",
            appId: "1:178714711978:web:fb831188be23e62a4bbdd3",
            measurementId: "G-LYZP41ZJ46"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM Elements
        const authOptionsContainer = document.getElementById('auth-options-container');
        const autoAuthBtn = document.getElementById('auto-auth');
        const fullAutoAuthBtn = document.getElementById('full-auto-auth');
        const manualAuthBtn = document.getElementById('manual-auth');
        
        const usernameFormContainer = document.getElementById('username-form-container');
        const usernameForm = document.getElementById('username-form');
        const usernameBackButton = document.getElementById('username-back-button');
        
        const manualFormContainer = document.getElementById('manual-form-container');
        const manualForm = document.getElementById('manual-form');
        const manualBackButton = document.getElementById('manual-back-button');
        
        const overlay = document.getElementById('overlay');
        const loaderText = document.getElementById('loader-text');
        
        // Form elements
        const username = document.getElementById('username');
        const usernameError = document.getElementById('username-error');
        const startButton = document.getElementById('start-button');
        
        const email = document.getElementById('email');
        const password = document.getElementById('password');
        const loginUsername = document.getElementById('login-username');
        const emailError = document.getElementById('email-error');
        const passwordError = document.getElementById('password-error');
        const loginUsernameError = document.getElementById('login-username-error');
        const loginButton = document.getElementById('login-button');

        // Initialize - hide form containers
        usernameFormContainer.style.display = 'none';
        manualFormContainer.style.display = 'none';

        // Check if user is already authenticated
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                try {
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists()) {
                        // User exists, redirect to chat
                        window.location.href = 'half.html';
                    }
                } catch (error) {
                    console.error("Error checking user data:", error);
                }
            }
        });

        // Helper functions
        function showLoading(message) {
            loaderText.textContent = message;
            overlay.classList.add('active');
        }

        function hideLoading() {
            overlay.classList.remove('active');
        }

        function showError(element, message) {
            element.textContent = message;
            element.style.display = 'block';
        }

        function hideError(element) {
            element.textContent = '';
            element.style.display = 'none';
        }

        function validateUsername(usernameValue) {
            const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
            if (!usernameValue) {
                return 'Username is required';
            }
            if (!usernameRegex.test(usernameValue)) {
                return 'Username must be 3-20 characters with only letters, numbers, and underscores';
            }
            return null;
        }

        function validateEmail(emailValue) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailValue) {
                return 'Email is required';
            }
            if (!emailRegex.test(emailValue)) {
                return 'Please enter a valid email address';
            }
            return null;
        }

        function validatePassword(passwordValue) {
            if (!passwordValue) {
                return 'Password is required';
            }
            if (passwordValue.length < 6) {
                return 'Password must be at least 6 characters long';
            }
            return null;
        }

        // Generate random credentials
        function generateRandomCredentials(includeUsername = false) {
            const randomString = Math.random().toString(36).substring(2, 12) + Math.floor(Math.random() * 10000);
            const email = `user_${randomString}@nmedea-auto.com`;
            const password = `Auto${randomString}${Math.floor(Math.random() * 1000)}!`;
            const username = includeUsername ? `user_${Math.random().toString(36).substring(2, 8)}` : null;
            
            return { email, password, username };
        }

        // Show auth options, hide forms
        function showAuthOptions() {
            authOptionsContainer.style.display = 'flex';
            authOptionsContainer.style.opacity = '1';
            usernameFormContainer.style.display = 'none';
            manualFormContainer.style.display = 'none';
        }

        // Hide auth options, show specific form
        function showForm(formContainer) {
            // Hide options with animation
            authOptionsContainer.style.opacity = '0';
            setTimeout(() => {
                authOptionsContainer.style.display = 'none';
                formContainer.style.display = 'block';
                // Trigger animation by forcing a reflow
                void formContainer.offsetWidth;
                formContainer.style.opacity = '1';
            }, 300);
        }

        // Semi-Auto Auth button click
        autoAuthBtn.addEventListener('click', async () => {
            showForm(usernameFormContainer);
            
            // Show loading overlay
            showLoading('Generating authentication keys...');
            
            // Generate random credentials
            const { email, password } = generateRandomCredentials();
            
            // Simulate network delay
            setTimeout(async () => {
                try {
                    // Try to create new user with generated credentials
                    loaderText.textContent = 'Authenticating...';
                    
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    
                    // Update loading text
                    loaderText.textContent = 'Almost there...';
                    
                    // Wait a moment then hide loading
                    setTimeout(() => {
                        hideLoading();
                        
                        // Store user ID for later
                        usernameForm.dataset.uid = userCredential.user.uid;
                        usernameForm.dataset.email = email;
                    }, 1000);
                    
                } catch (error) {
                    console.error("Auto auth error:", error);
                    hideLoading();
                    showError(usernameError, "Authentication failed. Please try again or use manual login.");
                }
            }, 1500);
        });

        // Full Auto Auth button click
        fullAutoAuthBtn.addEventListener('click', async () => {
            // Show loading overlay
            showLoading('Setting up your account...');
            
            // Generate random credentials with username
            const { email, password, username } = generateRandomCredentials(true);
            
            // Simulate network delay
            setTimeout(async () => {
                try {
                    // Try to create new user with generated credentials
                    loaderText.textContent = 'Creating your account...';
                    
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    
                    // Create user document with generated username
                    loaderText.textContent = 'Finalizing setup...';
                    
                    await setDoc(doc(db, 'users', userCredential.user.uid), {
                        uid: userCredential.user.uid,
                        email: email,
                        username: username,
                        autoGenerated: true,
                        fullAuto: true,
                        createdAt: new Date().toISOString()
                    });
                    
                    // Update loading text for redirection
                    loaderText.textContent = 'Account created successfully!';
                    
                    // Wait a moment then redirect
                    setTimeout(() => {
                        loaderText.textContent = 'Redirecting to chat...';
                        setTimeout(() => {
                            window.location.href = 'half.html';
                        }, 1000);
                    }, 1000);
                    
                } catch (error) {
                    console.error("Full auto auth error:", error);
                    hideLoading();
                    showAuthOptions();
                    alert("Authentication failed. Please try again or use another method.");
                }
            }, 2000);
        });

        // Manual Auth button click
        manualAuthBtn.addEventListener('click', () => {
            showForm(manualFormContainer);
        });

        // Back buttons
        usernameBackButton.addEventListener('click', showAuthOptions);
        manualBackButton.addEventListener('click', showAuthOptions);

        
// Username form submit
usernameForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Validate username
    const usernameValue = username.value.trim();
    const error = validateUsername(usernameValue);
    
    hideError(usernameError);
    
    if (error) {
        showError(usernameError, error);
        return;
    }
    
    showLoading('Setting up your profile...');
    
    // Get stored user ID
    const uid = usernameForm.dataset.uid;
    const userEmail = usernameForm.dataset.email;
    
    try {
        // Update user document with username
        await setDoc(doc(db, 'users', uid), {
            uid: uid,
            email: userEmail,
            username: usernameValue,
            autoGenerated: true,
            fullAuto: false,
            createdAt: new Date().toISOString()
        });
        
        // Wait a moment for dramatic effect
        setTimeout(() => {
            loaderText.textContent = 'Profile created successfully!';
            
            // Redirect to chat
            setTimeout(() => {
                loaderText.textContent = 'Redirecting to chat...';
                setTimeout(() => {
                    window.location.href = 'half.html';
                }, 1000);
            }, 1000);
        }, 1000);
        
    } catch (error) {
        console.error("Username setup error:", error);
        hideLoading();
        showError(usernameError, "Failed to set username. Please try again.");
    }
});

// Manual form submit
manualForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Validate inputs
    const emailValue = email.value.trim();
    const passwordValue = password.value.trim();
    const usernameValue = loginUsername.value.trim();
    
    hideError(emailError);
    hideError(passwordError);
    hideError(loginUsernameError);
    
    const emailErrorMsg = validateEmail(emailValue);
    const passwordErrorMsg = validatePassword(passwordValue);
    const usernameErrorMsg = validateUsername(usernameValue);
    
    if (emailErrorMsg) {
        showError(emailError, emailErrorMsg);
        return;
    }
    
    if (passwordErrorMsg) {
        showError(passwordError, passwordErrorMsg);
        return;
    }
    
    if (usernameErrorMsg) {
        showError(loginUsernameError, usernameErrorMsg);
        return;
    }
    
    showLoading('Authenticating...');
    
    try {
        // Try to sign in first
        try {
            await signInWithEmailAndPassword(auth, emailValue, passwordValue);
            
            // If successful, redirect to chat
            loaderText.textContent = 'Login successful!';
            setTimeout(() => {
                loaderText.textContent = 'Redirecting to chat...';
                setTimeout(() => {
                    window.location.href = 'half.html';
                }, 1000);
            }, 1000);
            
            return;
        } catch (signInError) {
            // If sign in fails, try to create new account
            const userCredential = await createUserWithEmailAndPassword(auth, emailValue, passwordValue);
            
            // Create user document
            await setDoc(doc(db, 'users', userCredential.user.uid), {
                uid: userCredential.user.uid,
                email: emailValue,
                username: usernameValue,
                autoGenerated: false,
                fullAuto: false,
                createdAt: new Date().toISOString()
            });
            
            loaderText.textContent = 'Account created!';
            setTimeout(() => {
                loaderText.textContent = 'Redirecting to chat...';
                setTimeout(() => {
                    window.location.href = 'half.html';
                }, 1000);
            }, 1000);
        }
    } catch (error) {
        console.error("Manual auth error:", error);
        hideLoading();
        
        if (error.code === 'auth/email-already-in-use') {
            showError(emailError, 'This email is already registered with a different password');
        } else if (error.code === 'auth/invalid-credential') {
            showError(emailError, 'Invalid email or password');
        } else {
            showError(emailError, 'Authentication failed. Please try again.');
        }
    }
});

// Real-time validation
username.addEventListener('input', () => {
    const error = validateUsername(username.value.trim());
    if (error) {
        showError(usernameError, error);
    } else {
        hideError(usernameError);
    }
});

email.addEventListener('input', () => {
    const error = validateEmail(email.value.trim());
    if (error) {
        showError(emailError, error);
    } else {
        hideError(emailError);
    }
});

password.addEventListener('input', () => {
    const error = validatePassword(password.value.trim());
    if (error) {
        showError(passwordError, error);
    } else {
        hideError(passwordError);
    }
});

loginUsername.addEventListener('input', () => {
    const error = validateUsername(loginUsername.value.trim());
    if (error) {
        showError(loginUsernameError, error);
    } else {
        hideError(loginUsernameError);
    }
});
</script>



<script>
  // Immediately hide everything to prevent flickering  
  document.documentElement.style.visibility = 'hidden';
  
  // Check local storage for theme preference from the page  
  const themePreference = localStorage.getItem('twitter-theme') || 'light';
  
  // Define luxury gradient (static but refined)  
  const luxuryGradient = `linear-gradient(
    135deg,  
    #0D1B2A 0%,   /* Midnight Sapphire - Deep, Timeless Trust */
    #B22222 50%,  /* Royal Crimson - Prestige, Power, Strength */
    #D4AF37 100%  /* Imperial Gold - Pure Luxury & Success */
  )`;
  
  // Create splash screen container  
  const splashScreen = document.createElement('div');
  splashScreen.style.cssText = `  
    position: fixed;  
    top: 0;  
    left: 0;  
    width: 100vw;  
    height: 100vh;  
    background-color: ${themePreference === 'light' ? '#f7f9fa' : themePreference === 'dim' ? '#15202b' : '#000000'};  
    display: flex;  
    flex-direction: column;  
    justify-content: center;  
    align-items: center;  
    z-index: 9999;  
    opacity: 1;  
    transition: opacity 0.5s ease-in-out;  
  `;
  
  // Create content wrapper  
  const contentWrapper = document.createElement('div');
  contentWrapper.style.cssText = `  
    position: relative;  
    height: 100%;  
    width: 100%;  
    display: flex;  
    flex-direction: column;  
    justify-content: center;  
    align-items: center;  
  `;
  
  // Create logo container - positioned in the middle  
  const logoContainer = document.createElement('div');
  logoContainer.style.cssText = `  
    position: absolute;  
    top: 50%;  
    left: 50%;  
    transform: translate(-50%, -50%);  
    width: 96px;  
    height: 96px;  
    display: flex;  
    justify-content: center;  
    align-items: center;  
  `;
  
  // Add style for the circle border (refined)
  const styleElement = document.createElement('style');
  styleElement.textContent = `  
    #splash-screen-logo::before {  
        content: '';  
        position: absolute;  
        top: -4px;  
        left: -4px;  
        right: -4px;  
        bottom: -4px;  
        border-radius: 50%;  
        background: ${luxuryGradient};  
        -webkit-mask:   
            linear-gradient(#fff 0 0) content-box,   
            linear-gradient(#fff 0 0);  
        -webkit-mask-composite: xor;  
        mask-composite: exclude;  
        border: 4px solid transparent;  
        z-index: 1;
    }  
  `;
  
  document.head.appendChild(styleElement);
  
  // Logo design with refined gradient border  
  const logoPlaceholder = document.createElement('div');
  logoPlaceholder.id = 'splash-screen-logo';
  logoPlaceholder.style.cssText = `  
    width: 100%;  
    height: 100%;  
    border-radius: 50%;  
    display: flex;  
    justify-content: center;  
    align-items: center;  
    position: relative;  
    background: ${themePreference === 'light' ? '#f7f9fa' : themePreference === 'dim' ? '#15202b' : '#000000'};
  `;
  
  const logoText = document.createElement('span');
  logoText.textContent = 'N';
  logoText.style.cssText = `  
    font-size: 48px;  
    font-weight: 700;  
    background: ${luxuryGradient};  
    -webkit-background-clip: text;  
    background-clip: text;  
    color: transparent;  
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;  
    z-index: 2;  
    letter-spacing: -1px;
  `;
  logoPlaceholder.appendChild(logoText);
  logoContainer.appendChild(logoPlaceholder);
  
  // Create company info container at the bottom  
  const companyInfoContainer = document.createElement('div');
  companyInfoContainer.style.cssText = `  
    position: absolute;  
    bottom: 15%;  
    left: 50%;  
    transform: translateX(-50%);  
    display: flex;  
    flex-direction: column;  
    align-items: center;  
    text-align: center;
  `;
  
  // Create "from" text (more elegant)
  const tagline = document.createElement('div');
  tagline.style.cssText = `  
    font-size: 14px;  
    color: ${themePreference === 'light' ? '#657786' : '#8899a6'};  
    margin-bottom: 6px;  
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;  
    font-weight: 400;
    letter-spacing: 0.5px;
    opacity: 0.8;
  `;
  tagline.textContent = 'from';
  
  // Create company name with refined gradient
  const companyName = document.createElement('h1');
  companyName.textContent = 'nmedea';
  companyName.style.cssText = `  
    font-size: 24px;  
    font-weight: 600;  
    margin: 0;  
    letter-spacing: 0.8px;  
    background: ${luxuryGradient};  
    -webkit-background-clip: text;  
    background-clip: text;  
    color: transparent;  
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;  
    text-transform: lowercase;
  `;
  
  // Append elements  
  companyInfoContainer.appendChild(tagline);
  companyInfoContainer.appendChild(companyName);
  contentWrapper.appendChild(logoContainer);
  contentWrapper.appendChild(companyInfoContainer);
  splashScreen.appendChild(contentWrapper);
  
  // Add to body immediately  
  document.body.insertBefore(splashScreen, document.body.firstChild);
  
  // Show the splash screen immediately  
  document.documentElement.style.visibility = 'visible';
  
  // Find and hide the auth container if it exists  
  const hideAuthContainer = () => {
    const authContainer = document.querySelector('.auth-container');
    if (authContainer) {
      authContainer.style.opacity = '0';
      authContainer.style.pointerEvents = 'none';
      authContainer.style.position = 'fixed';
      authContainer.style.top = '-100%';
    }
  };
  
  // Try to hide the auth container  
  hideAuthContainer();
  
  // Give it another try after a delay in case DOM isn't ready  
  setTimeout(hideAuthContainer, 100);
  
  // Remove splash screen and show content  
  const removeSplashScreen = () => {
    splashScreen.style.opacity = '0';
    
    setTimeout(() => {
      if (document.body.contains(splashScreen)) {
        document.body.removeChild(splashScreen);
      }
      
      // Restore any hidden containers  
      const authContainer = document.querySelector('.auth-container');
      if (authContainer) {
        authContainer.style.position = 'static';
        authContainer.style.top = '0';
        authContainer.style.opacity = '1';
        authContainer.style.pointerEvents = 'auto';
      }
    }, 500);
  };
  
  // Remove after 11 seconds  
  setTimeout(removeSplashScreen, 11000);
  
  // Expose a method to easily replace the logo  
  window.replaceSplashScreenLogo = (logoUrl) => {
    const logoElement = document.getElementById('splash-screen-logo');
    if (logoElement) {
      // Clear existing content  
      logoElement.innerHTML = '';
      
      // Create and append new logo image  
      const logoImage = document.createElement('img');
      logoImage.src = logoUrl;
      logoImage.style.cssText = `  
        width: 100%;  
        height: 100%;  
        object-fit: contain;  
        border-radius: 50%;
      `;
      logoElement.appendChild(logoImage);
    }
  };
</script>

<script>
  function createDownloadNotification() {
    // Check if running as PWA or standalone app
    if (window.matchMedia('(display-mode: standalone)').matches ||
      window.navigator.standalone ||
      document.referrer.includes('android-app://')) {
      return; // Don't show notification if it's installed as PWA
    }
    
    // Check if it's an Apple device (iPhone, iPad, etc.)
    const isAppleDevice = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
    if (isAppleDevice) {
      return; // Don't show notification on Apple devices
    }
    
    // More thorough browser detection
    const isBrowser = () => {
      const ua = navigator.userAgent.toLowerCase();
      
      // Check if it's a WebView
      const isWebView = /(webview|wv)/.test(ua) ||
        /windows.*phone/.test(ua) ||
        /android.*mobile/.test(ua) && /wv/.test(ua);
      
      // Check if it's a known mobile browser
      const isMobileBrowser = /chrome|safari|firefox|opera|edge|ie/i.test(ua) &&
        !isWebView &&
        !ua.includes('samsung') &&
        !ua.includes('miui') &&
        !ua.includes('huawei');
      
      // Check if it's a desktop browser
      const isDesktopBrowser = /chrome|firefox|opera|edge|ie/i.test(ua) &&
        !/(android|iphone|ipad|ipod|windows phone)/i.test(ua);
      
      // Return true only for mobile browsers, exclude desktop browsers
      return isMobileBrowser && !isDesktopBrowser;
    };
    
    // Only proceed if it's a regular mobile browser
    if (!isBrowser()) {
      return;
    }
    
    // Detect OS for customizing the message
    const userAgent = navigator.userAgent.toLowerCase();
    const isAndroid = /android/.test(userAgent);
    const isWindows = /windows/.test(userAgent);
    
    // Create notification container
    const notification = document.createElement("div");
    notification.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: #ffffff;
        color: #1da1f2; /* Twitter blue for text */
        padding: 16px;
        border-radius: 16px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        gap: 12px;
        opacity: 0;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10000;
        max-width: 90%;
        width: auto;
    `;
    
    // Add icon (N circle with blue fill)
    const iconContainer = document.createElement("div");
    iconContainer.innerHTML = `
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#1da1f2" stroke="#1da1f2" stroke-width="2">
            <circle cx="12" cy="12" r="10" fill="#1da1f2" />
            <text x="50%" y="50%" text-anchor="middle" stroke="none" fill="#ffffff" font-size="12" dy=".3em">N</text>
        </svg>
    `;
    
    // Create content
    const content = document.createElement("div");
    content.innerHTML = `
        <div style="font-size: 14px; font-weight: 500; margin-bottom: 4px; color: #1da1f2;">
            Download Available
        </div>
        <div style="font-size: 12px; opacity: 0.7; color: #1da1f2;">
            ${isAndroid ? 'Get it on Android' : 'Download for Windows'}
        </div>
    `;
    
    // Create buttons container
    const buttons = document.createElement("div");
    buttons.style.cssText = `
        display: flex;
        gap: 8px;
        margin-left: 12px;
    `;
    
    // Create action buttons
    const installButton = document.createElement("button");
    installButton.textContent = "Install";
    installButton.style.cssText = `
        background: #1da1f2; /* Twitter blue */
        color: #ffffff;
        border: none;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.3s;
    `;
    
    const cancelButton = document.createElement("button");
    cancelButton.textContent = "Not Now";
    cancelButton.style.cssText = `
        background: transparent;
        color: #1da1f2; /* Twitter blue */
        border: 1px solid #1da1f2;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.3s;
    `;
    
    // Add hover effects
    installButton.onmouseover = () => installButton.style.background = '#1991db'; /* Darker blue on hover */
    installButton.onmouseout = () => installButton.style.background = '#1da1f2';
    cancelButton.onmouseover = () => cancelButton.style.background = 'rgba(29, 161, 242, 0.1)'; /* Light blue on hover */
    cancelButton.onmouseout = () => cancelButton.style.background = 'transparent';
    
    // Handle button clicks
    installButton.onclick = () => {
      if (isAndroid) {
        const link = document.createElement('a');
        link.href = 'https://median.co/share/zjajxa#apk';
        link.download = 'app.apk';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        window.open('https://median.co/share/zjajxa#apk', '_blank');
      }
      hideNotification();
    };
    
    cancelButton.onclick = hideNotification;
    
    // Assemble notification
    buttons.appendChild(installButton);
    buttons.appendChild(cancelButton);
    notification.appendChild(iconContainer);
    notification.appendChild(content);
    notification.appendChild(buttons);
    document.body.appendChild(notification);
    
    // Show animation
    setTimeout(() => {
      notification.style.opacity = '1';
      notification.style.transform = 'translateX(-50%) translateY(0)';
    }, 100);
    
    function hideNotification() {
      notification.style.opacity = '0';
      notification.style.transform = 'translateX(-50%) translateY(100px)';
      setTimeout(() => notification.remove(), 500);
    }
  }
  
  // Show notification when page loads
  window.addEventListener('load', createDownloadNotification);
</script>
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "b7b291e1-5bd8-46b6-b698-ade4de650caa",
    });
  });
</script>