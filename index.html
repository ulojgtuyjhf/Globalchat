<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Primary Meta Tags -->
    <title>Login - Global Chat Room | Nmedea.com</title>
    <meta name="title" content="Login - Global Chat Room | Nmedea.com">
    <meta name="description" content="Join our global chat community at Nmedea.com. Connect with people worldwide in real-time. Safe, secure, and easy to use chat platform for international communication.">
    
    <!-- Keywords -->
    <meta name="keywords" content="global chat, chat room, online chat, international chat, nmedea chat, secure chat, real-time chat, chat community, social platform">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nmedea.com/login">
    <meta property="og:title" content="Login to Global Chat Room - Nmedea.com">
    <meta property="og:description" content="Connect with people worldwide in our global chat community. Join now for real-time conversations and make friends across borders.">
    <meta property="og:image" content="https://nmedea.com/images/og-image.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://nmedea.com/login">
    <meta property="twitter:title" content="Login to Global Chat Room - Nmedea.com">
    <meta property="twitter:description" content="Connect with people worldwide in our global chat community. Join now for real-time conversations and make friends across borders.">
    <meta property="twitter:image" content="https://nmedea.com/images/twitter-image.jpg">
    
    <!-- Additional SEO Tags -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="Nmedea.com">
    <meta name="language" content="English">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="stylesheet" href="login.css">
    <link rel="icon" type="image/jpg" href="/storage/emulated/0/Pictures/Screenshot/Screenshot_20250331-185745.jpg">
    
    
    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

     <style>
       
:root {
    --primary: #5e72e4;
    --primary-dark: #4454c3;
    --background: #f7f9fa;
    --card: #ffffff;
    --text: #14171A;
    --text-light: #657786;
    --text-secondary: #AAB8C2;
    --border: #E1E8ED;
    --error: #E0245E;
    --success: #17BF63;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

body {
    min-height: 100vh;
    background-color: var(--background);
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%231da1f2' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
    color: var(--text);
    padding: 0;
    margin: 0;
    overflow-x: hidden;
}

.logo {
    font-size: 24px;
    font-weight: bold;
    color: var(--primary);
    text-align: left;
    position: fixed;
    top: 30px;
    left: 30px;
    z-index: 10;
    background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 15%, #3a3a3a 30%, #4d4d4d 45%, #626262 60%, #787878 75%, #8f8f8f 90%, #a6a6a6 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

.auth-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    width: 100%;
    padding: 20px;
    max-width: 100%;
    background: transparent;
    box-shadow: none;
}

.welcome-text {
    text-align: center;
    margin-bottom: 40px;
    animation: fadeInDown 0.5s ease;
}

.welcome-text h2 {
    font-size: 28px;
    margin-bottom: 12px;
    color: var(--text);
    font-weight: 800;
}

.welcome-text p {
    color: var(--text-light);
    font-size: 16px;
}

.auth-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
    max-width: 380px;
    animation: fadeIn 0.5s ease;
}

.auth-option {
    display: flex;
    align-items: center;
    padding: 16px 20px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
    overflow: hidden;
}

.auth-option:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 15%, #3a3a3a 30%, #4d4d4d 45%, #626262 60%, #787878 75%, #8f8f8f 90%, #a6a6a6 100%);
    opacity: 0;
    z-index: -1;
    transition: opacity 0.3s ease;
}

.auth-option:hover {
    border-color: #626262;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(98, 98, 98, 0.2);
    color: white;
}

.auth-option:hover:before {
    opacity: 1;
}

.auth-option:hover .auth-option-title,
.auth-option:hover .auth-option-description {
    color: white;
}

.auth-option:active {
    transform: translateY(0);
    box-shadow: 0 2px 5px rgba(98, 98, 98, 0.2);
}

.auth-option-icon {
    width: 24px;
    height: 24px;
    margin-right: 15px;
    color: #626262;
    transition: color 0.3s ease;
}

.auth-option:hover .auth-option-icon {
    color: white;
}

.auth-option-text {
    flex: 1;
    transition: color 0.3s ease;
}

.auth-option-title {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 4px;
    color: var(--text);
    transition: color 0.3s ease;
}

.auth-option-description {
    font-size: 14px;
    color: var(--text-light);
    transition: color 0.3s ease;
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(5px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1);
}

.overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal {
    background: var(--card);
    border-radius: 16px;
    padding: 25px;
    width: 90%;
    max-width: 420px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    transform: translateY(30px) scale(0.95);
    transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1);
    position: relative;
    opacity: 0;
}

.overlay.active .modal {
    transform: translateY(0) scale(1);
    opacity: 1;
}

.modal-close {
    position: absolute;
    right: 20px;
    top: 20px;
    width: 24px;
    height: 24px;
    cursor: pointer;
    color: var(--text-light);
    transition: color 0.2s ease, transform 0.2s ease;
}

.modal-close:hover {
    color: var(--error);
    transform: rotate(90deg);
}

.modal-header {
    margin-bottom: 25px;
    text-align: center;
}

.modal-header h3 {
    font-size: 21px;
    margin-bottom: 8px;
    font-weight: 800;
}

.modal-header p {
    color: var(--text-light);
    font-size: 15px;
}

.input-group {
    margin-bottom: 20px;
    position: relative;
}

.error-message {
    color: var(--error);
    font-size: 14px;
    margin-top: 6px;
    display: none;
    font-weight: 500;
}

label {
    display: block;
    margin-bottom: 10px;
    color: var(--text);
    font-weight: 600;
    font-size: 15px;
}

input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border);
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.2s ease;
    background: var(--background);
    color: var(--text);
}

input:focus {
    border-color: #626262;
    background: var(--card);
    outline: none;
    box-shadow: 0 0 0 3px rgba(98, 98, 98, 0.2);
}

input.error {
    border-color: var(--error);
}

button {
    width: 100%;
    padding: 14px 16px;
    border: none;
    border-radius: 50px;
    background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 15%, #3a3a3a 30%, #4d4d4d 45%, #626262 60%, #787878 75%, #8f8f8f 90%, #a6a6a6 100%);
    color: white;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(98, 98, 98, 0.3);
}

button:active {
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(98, 98, 98, 0.3);
}

button:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.captcha-container {
    margin: 25px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.captcha-checkbox {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    border: 2px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.captcha-checkbox.checked {
    border-color: var(--success);
    background-color: rgba(23, 191, 99, 0.05);
}

.checkbox-icon {
    width: 18px;
    height: 18px;
    border: 2px solid var(--text-light);
    border-radius: 4px;
    margin-right: 12px;
    position: relative;
    transition: all 0.2s ease;
}

.captcha-checkbox.checked .checkbox-icon {
    background-color: var(--success);
    border-color: var(--success);
}

.checkbox-icon::after {
    content: '';
    position: absolute;
    top: 45%;
    left: 20%;
    width: 6px;
    height: 11px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg) translate(-50%, -50%);
    opacity: 0;
    transition: opacity 0.2s ease;
}

.captcha-checkbox.checked .checkbox-icon::after {
    opacity: 1;
}

.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 25px 15px;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(98, 98, 98, 0.1);
    border-radius: 50%;
    border-top-color: #626262;
    animation: spin 0.8s linear infinite;
    margin-bottom: 25px;
}

.loading-text {
    font-size: 18px;
    color: var(--text);
    margin-bottom: 10px;
    text-align: center;
    font-weight: 700;
}

.loading-subtext {
    font-size: 15px;
    color: var(--text-light);
    text-align: center;
    max-width: 300px;
}

.loading-progress {
    width: 100%;
    height: 4px;
    background-color: var(--border);
    border-radius: 2px;
    margin: 20px 0;
    overflow: hidden;
    position: relative;
}

.loading-progress-bar {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 15%, #3a3a3a 30%, #4d4d4d 45%, #626262 60%, #787878 75%, #8f8f8f 90%, #a6a6a6 100%);
    border-radius: 2px;
    width: 0%;
    transition: width 0.5s cubic-bezier(0.19, 1, 0.22, 1);
}

.button-spinner {
    display: none;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 0.8s linear infinite;
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-15px); }
    to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 767px) {
    .logo {
        font-size: 22px;
        top: 20px;
        left: 20px;
    }
    
    .welcome-text h2 {
        font-size: 24px;
    }
    
    .welcome-text p {
        font-size: 15px;
    }
    
    .overlay.active .modal {
        height: 100%;
        width: 100%;
        max-width: 100%;
        border-radius: 0;
    }
}

    </style>
</head>
<body>
    <div class="logo">Nmedea</div>

    <div class="auth-container">
        <div class="welcome-text">
            <h2>Welcome to Nmedea</h2>
            <p>Connect with people around the world seamlessly</p>
        </div>

        <div class="auth-options">
            <div class="auth-option" id="manual-auth">
                <svg class="auth-option-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <div class="auth-option-text">
                    <div class="auth-option-title">Manual Setup</div>
                    <div class="auth-option-description">Register with your own email & password</div>
                </div>
            </div>

            <div class="auth-option" id="semi-auto-auth">
                <svg class="auth-option-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <path d="M20 8v6"></path>
                    <path d="M23 11h-6"></path>
                </svg>
                <div class="auth-option-text">
                    <div class="auth-option-title">Semi-Auto Setup</div>
                    <div class="auth-option-description">Choose username, we handle credentials</div>
                </div>
            </div>

            <div class="auth-option" id="auto-auth">
                <svg class="auth-option-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
                <div class="auth-option-text">
                    <div class="auth-option-title">Auto Setup</div>
                    <div class="auth-option-description">One-click fully automated setup</div>
                </div>
            </div>

            <div class="auth-option" id="login">
                <svg class="auth-option-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                    <polyline points="10 17 15 12 10 7"></polyline>
                    <line x1="15" y1="12" x2="3" y2="12"></line>
                </svg>
                <div class="auth-option-text">
                    <div class="auth-option-title">Login</div>
                    <div class="auth-option-description">Already have an account? Sign in</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div class="overlay" id="modal-overlay">
        <!-- Manual Auth Modal -->
        <div class="modal" id="manual-auth-modal">
            <svg class="modal-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            <div class="modal-header">
                <h3>Create Your Account</h3>
                <p>Please fill in your details to register</p>
            </div>
            <form id="manual-auth-form">
                <div class="input-group">
                    <label for="manual-username">Username</label>
                    <input type="text" id="manual-username" required>
                    <div class="error-message" id="manual-username-error"></div>
                </div>
                <div class="input-group">
                    <label for="manual-email">Email</label>
                    <input type="email" id="manual-email" required>
                    <div class="error-message" id="manual-email-error"></div>
                </div>
                <div class="input-group">
                    <label for="manual-password">Password</label>
                    <input type="password" id="manual-password" required>
                    <div class="error-message" id="manual-password-error"></div>
                </div>
                <div class="error-message" id="manual-form-error"></div>
                <button type="submit">
                    Create Account
                    <div class="button-spinner"></div>
                </button>
            </form>
        </div>

        <!-- Semi-Auto Auth Modal -->
        <div class="modal" id="semi-auto-auth-modal">
            <svg class="modal-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            <div class="modal-header">
                <h3>Create Your Username</h3>
                <p>We'll handle the rest automatically</p>
            </div>
            <form id="semi-auto-auth-form">
                <div class="input-group">
                    <label for="semi-auto-username">Choose Your Username</label>
                    <input type="text" id="semi-auto-username" required>
                    <div class="error-message" id="semi-auto-username-error"></div>
                </div>
                <div class="error-message" id="semi-auto-form-error"></div>
                <button type="submit">
                    Generate Authentication
                    <div class="button-spinner"></div>
                </button>
            </form>
        </div>

        <!-- Auto Auth Modal -->
        <div class="modal" id="auto-auth-modal">
            <svg class="modal-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            <div class="modal-header">
                <h3>Automatic Setup</h3>
                <p>Click to create your account instantly</p>
            </div>
            <form id="auto-auth-form">
                <div class="error-message" id="auto-form-error"></div>
                <button type="submit">
                    Authenticate
                    <div class="button-spinner"></div>
                </button>
            </form>
        </div>

        <!-- Login Modal -->
        <div class="modal" id="login-modal">
            <svg class="modal-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            <div class="modal-header">
                <h3>Welcome Back</h3>
                <p>Sign in to continue to Nmedea</p>
            </div>
            <form id="login-form">
                <div class="input-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                    <div class="error-message" id="login-email-error"></div>
                </div>
                <div class="input-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                    <div class="error-message" id="login-password-error"></div>
                </div>
                <div class="captcha-container">
                    <div class="captcha-checkbox" id="captcha-checkbox">
                        <div class="checkbox-icon"></div>
                        <span>I'm not a robot</span>
                    </div>
                </div>
                <div class="error-message" id="login-form-error"></div>
                <button type="submit" id="login-button" disabled>
                    Sign In
                    <div class="button-spinner"></div>
                </button>
            </form>
        </div>

        <!-- Loading Modal -->
        <div class="modal" id="loading-modal">
            <div class="loading">
                <div class="spinner"></div>
                <div class="loading-text" id="loading-text">Processing...</div>
                <div class="loading-subtext" id="loading-subtext"></div>
                <div class="loading-progress">
                    <div class="loading-progress-bar" id="loading-progress-bar"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        

// Import Firebase modules
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, setDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyDnPz8BWCaXJOazlFVO4Eap8VxdSR2oDFQ",
    authDomain: "globalchat-2d669.firebaseapp.com",
    projectId: "globalchat-2d669",
    storageBucket: "globalchat-2d669.firebasestorage.app",
    messagingSenderId: "178714711978",
    appId: "1:178714711978:web:fb831188be23e62a4bbdd3",
    measurementId: "G-LYZP41ZJ46"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// DOM Elements
const modalOverlay = document.getElementById('modal-overlay');
const manualAuthModal = document.getElementById('manual-auth-modal');
const semiAutoAuthModal = document.getElementById('semi-auto-auth-modal');
const autoAuthModal = document.getElementById('auto-auth-modal');
const loginModal = document.getElementById('login-modal');
const loadingModal = document.getElementById('loading-modal');
const captchaCheckbox = document.getElementById('captcha-checkbox');
const loginButton = document.getElementById('login-button');

// Current active modal
let currentModal = null;
// Track login attempts
let loginAttempts = 0;
const MAX_LOGIN_ATTEMPTS = 3;
// Track captcha verification
let isCaptchaVerified = false;

// Helper Functions
function showModal(modal) {
    hideAllModals();
    currentModal = modal;
    modalOverlay.classList.add('active');
    modal.style.display = 'block';
}

function hideAllModals() {
    manualAuthModal.style.display = 'none';
    semiAutoAuthModal.style.display = 'none';
    autoAuthModal.style.display = 'none';
    loginModal.style.display = 'none';
    loadingModal.style.display = 'none';
}

function hideModalOverlay() {
    modalOverlay.classList.remove('active');
    currentModal = null;
    hideAllModals();
}

function showError(elementId, message) {
    const errorElement = document.getElementById(elementId);
    if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }
}

function clearErrors() {
    document.querySelectorAll('.error-message').forEach(error => {
        error.textContent = '';
        error.style.display = 'none';
    });
}

function validateInput(input) {
    const value = input.value.trim();

    if (!value && input.required) {
        return 'This field is required';
    }

    switch (input.type) {
        case 'email':
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(value)) {
                return 'Please enter a valid email address';
            }
            break;
        case 'password':
            if (value.length < 6) {
                return 'Password must be at least 6 characters long';
            }
            break;
        case 'text':
            if (input.id.includes('username')) {
                const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
                if (!usernameRegex.test(value)) {
                    return 'Username must be 3-20 characters and can only contain letters, numbers, and underscores';
                }
            }
            break;
    }
    return null;
}

function verifyCaptcha() {
    // Simulate captcha verification with a 90% success rate
    const randomSuccess = Math.random() > 0.1;
    isCaptchaVerified = randomSuccess;
    
    if (isCaptchaVerified) {
        captchaCheckbox.classList.add('checked');
        loginButton.disabled = false;
    } else {
        captchaCheckbox.classList.remove('checked');
        loginButton.disabled = true;
        showError('login-form-error', 'Captcha verification failed. Please try again.');
    }
    
    return isCaptchaVerified;
}

function showLoading(text, subtext) {
    hideAllModals();
    document.getElementById('loading-text').textContent = text || 'Processing...';
    document.getElementById('loading-subtext').textContent = subtext || '';
    document.getElementById('loading-progress-bar').style.width = '0%';
    loadingModal.style.display = 'block';
}

function updateLoadingProgress(percentage, text, subtext) {
    document.getElementById('loading-progress-bar').style.width = `${percentage}%`;
    if (text) document.getElementById('loading-text').textContent = text;
    if (subtext) document.getElementById('loading-subtext').textContent = subtext;
}

function simulateProgressAnimation(steps, onComplete) {
    let currentStep = 0;
    const interval = setInterval(() => {
        if (currentStep >= steps.length) {
            clearInterval(interval);
            if (onComplete) onComplete();
            return;
        }
        
        const step = steps[currentStep];
        updateLoadingProgress(
            step.percentage,
            step.text || document.getElementById('loading-text').textContent,
            step.subtext || document.getElementById('loading-subtext').textContent
        );
        currentStep++;
    }, 800);
}

// Generate random credentials
function generateRandomEmail() {
    const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
    let result = '';
    for (let i = 0; i < 10; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return `${result}@nmedea.auto.com`;
}

function generateRandomPassword() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
    let result = '';
    for (let i = 0; i < 12; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
}

// Check if username is already taken (mock function)
async function isUsernameTaken(username) {
    // Simulate delay for server check
    await new Promise(resolve => setTimeout(resolve, 800));
    // Randomly return true or false with higher probability for false
    return Math.random() < 0.2; // 20% chance of username being taken
}

// Check if email is already registered (mock function for demonstration)
async function isEmailRegistered(email) {
    // Simulate delay for server check
    await new Promise(resolve => setTimeout(resolve, 800));
    // Randomly return true or false with higher probability for false
    return Math.random() < 0.15; // 15% chance of email being registered
}

// Register user and redirect
async function registerUser(email, password, username, isAuto = false) {
    try {
        // Check if username is taken
        const usernameTaken = await isUsernameTaken(username);
        if (usernameTaken) {
            throw new Error(`Username "${username}" is already taken. Please choose another.`);
        }
        
        // Check if email is registered (for non-auto setup)
        if (!isAuto) {
            const emailRegistered = await isEmailRegistered(email);
            if (emailRegistered) {
                throw new Error('This email is already registered. Please use another email or try logging in.');
            }
        }

        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const userData = {
            uid: userCredential.user.uid,
            email,
            username,
            createdAt: new Date().toISOString(),
            isAutoGenerated: isAuto
        };

        await setDoc(doc(db, 'users', userCredential.user.uid), userData);
        
        // Simulate redirection process
        const redirectSteps = [
            { percentage: 85, text: "Setting up profile...", subtext: "Almost there!" },
            { percentage: 100, text: "Success!", subtext: "Redirecting to chat..." }
        ];
        
        simulateProgressAnimation(redirectSteps, () => {
            setTimeout(() => {
                window.location.href = 'half.html';
            }, 1000);
        });
        
        return userCredential.user;
    } catch (error) {
        console.error("Registration error:", error);
        if (error.code === 'auth/email-already-in-use') {
            throw new Error('This email is already registered. Please use another email or try logging in.');
        } else if (error.message) {
            throw new Error(error.message);
        } else {
            throw new Error('An error occurred during registration. Please try again later.');
        }
    }
}

// Event Listeners
document.getElementById('manual-auth').addEventListener('click', () => {
    showModal(manualAuthModal);
});

document.getElementById('semi-auto-auth').addEventListener('click', () => {
    showModal(semiAutoAuthModal);
});

document.getElementById('auto-auth').addEventListener('click', () => {
    showModal(autoAuthModal);
});

document.getElementById('login').addEventListener('click', () => {
    // Reset login attempts when opening the login modal
    loginAttempts = 0;
    isCaptchaVerified = false;
    captchaCheckbox.classList.remove('checked');
    loginButton.disabled = true;
    showModal(loginModal);
});

// Close modal when clicking overlay or X button
document.querySelectorAll('.modal-close').forEach(closeBtn => {
    closeBtn.addEventListener('click', hideModalOverlay);
});

modalOverlay.addEventListener('click', (e) => {
    if (e.target === modalOverlay) {
        hideModalOverlay();
    }
});

// Captcha functionality
captchaCheckbox.addEventListener('click', () => {
    verifyCaptcha();
});

// Manual Auth Form
document.getElementById('manual-auth-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    clearErrors();

    const username = document.getElementById('manual-username').value;
    const email = document.getElementById('manual-email').value;
    const password = document.getElementById('manual-password').value;
    const button = e.target.querySelector('button');
    const spinner = button.querySelector('.button-spinner');

    // Validate inputs
    const inputs = e.target.querySelectorAll('input');
    let isValid = true;

    inputs.forEach(input => {
        const error = validateInput(input);
        if (error) {
            showError(`${input.id}-error`, error);
            isValid = false;
        }
    });

    if (!isValid) return;

    button.disabled = true;
    spinner.style.display = 'block';

    try {
        showLoading("Creating your account...", "Please wait while we set up your profile");
        
        const processSteps = [
            { percentage: 30, text: "Validating information...", subtext: "Checking username availability" },
            { percentage: 60, text: "Creating secure account...", subtext: "Setting up your credentials" }
        ];
        
        simulateProgressAnimation(processSteps, async () => {
            try {
                await registerUser(email, password, username, false);
            } catch (error) {
                hideModalOverlay();
                showModal(manualAuthModal);
                
                showError('manual-form-error', error.message);
                button.disabled = false;
                spinner.style.display = 'none';
            }
        });
    } catch (error) {
        showError('manual-form-error', 'An error occurred. Please try again.');
        button.disabled = false;
        spinner.style.display = 'none';
    }
});

// Semi-Auto Auth Form
document.getElementById('semi-auto-auth-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    clearErrors();

    const username = document.getElementById('semi-auto-username').value;
    const button = e.target.querySelector('button');
    const spinner = button.querySelector('.button-spinner');

    // Validate username
    const usernameError = validateInput(document.getElementById('semi-auto-username'));
    if (usernameError) {
        showError('semi-auto-username-error', usernameError);
        return;
    }

    button.disabled = true;
    spinner.style.display = 'block';

    try {
        showLoading("Generating authentication...", "Creating secure credentials for you");
        
        const processSteps = [
            { percentage: 20, text: "Validating username...", subtext: "Checking availability" },
            { percentage: 40, text: "Generating email...", subtext: "Creating secure identifier" },
            { percentage: 60, text: "Generating password...", subtext: "Creating strong encryption key" },
            { percentage: 80, text: "Setting up account...", subtext: "Almost there" }
        ];
        
        simulateProgressAnimation(processSteps, async () => {
            try {
                // Generate random email and password
                const email = generateRandomEmail();
                const password = generateRandomPassword();
                
                await registerUser(email, password, username, true);
            } catch (error) {
                hideModalOverlay();
                showModal(semiAutoAuthModal);
                showError('semi-auto-form-error', error.message);
                button.disabled = false;
                spinner.style.display = 'none';
            }
        });
    } catch (error) {
        showError('semi-auto-form-error', 'An error occurred. Please try again.');
        button.disabled = false;
        spinner.style.display = 'none';
    }
});

// Auto Auth Form
document.getElementById('auto-auth-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    clearErrors();

    const button = e.target.querySelector('button');
    const spinner = button.querySelector('.button-spinner');

    button.disabled = true;
    spinner.style.display = 'block';

    try {
        showLoading("Starting automatic setup...", "Please wait while we set everything up for you");
        
        const processSteps = [
            { percentage: 15, text: "Initializing...", subtext: "Preparing authentication system" },
            { percentage: 30, text: "Generating username...", subtext: "Creating unique identifier" },
            { percentage: 45, text: "Generating email...", subtext: "Setting up secure communication" },
            { percentage: 60, text: "Generating password...", subtext: "Building strong encryption" },
            { percentage: 75, text: "Creating account...", subtext: "Setting up your profile" }
        ];
        
        simulateProgressAnimation(processSteps, async () => {
            try {
                // Generate random username, email and password
                const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
                let username = 'user_';
                for (let i = 0; i < 8; i++) {
                    username += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                
                const email = generateRandomEmail();
                const password = generateRandomPassword();
                
                await registerUser(email, password, username, true);
            } catch (error) {
                hideModalOverlay();
                showModal(autoAuthModal);
                showError('auto-form-error', error.message);
                button.disabled = false;
                spinner.style.display = 'none';
            }
        });
    } catch (error) {
        showError('auto-form-error', 'An error occurred. Please try again.');
        button.disabled = false;
        spinner.style.display = 'none';
    }
});

// Login Form
document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    clearErrors();

    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    const button = e.target.querySelector('button');
    const spinner = button.querySelector('.button-spinner');

    // Validate inputs
    const emailInput = document.getElementById('login-email');
    const passwordInput = document.getElementById('login-password');
    const emailError = validateInput(emailInput);
    const passwordError = validateInput(passwordInput);

    if (emailError) {
        showError('login-email-error', emailError);
        return;
    }
    if (passwordError) {
        showError('login-password-error', passwordError);
        return;
    }

    if (!captchaCheckbox.classList.contains('checked') || !isCaptchaVerified) {
        showError('login-form-error', 'Please confirm you are not a robot');
        return;
    }

    // Increment login attempts
    loginAttempts++;
    
    button.disabled = true;
    spinner.style.display = 'block';

    try {
        showLoading("Signing you in...", "Authenticating your credentials");
        
        const processSteps = [
            { percentage: 30, text: "Verifying email...", subtext: "Checking account details" },
            { percentage: 60, text: "Authenticating...", subtext: "Verifying your identity" }
        ];
        
        simulateProgressAnimation(processSteps, async () => {
            try {
                // Simulate auth logic with random success/failure for demonstration
                if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                    throw { code: 'auth/too-many-requests', message: 'Too many failed login attempts. Please try again later.' };
                }
                
                // For demonstration, fail with 40% probability
                const randomFail = Math.random() < 0.4;
                
                if (randomFail) {
                    throw { code: 'auth/wrong-password', message: 'Invalid email or password' };
                }
                
                await signInWithEmailAndPassword(auth, email, password);
                
                updateLoadingProgress(100, "Success!", "Redirecting to chat...");
                
                setTimeout(() => {
                    window.location.href = 'half.html';
                }, 1000);
            } catch (error) {
                hideModalOverlay();
                showModal(loginModal);
                
                // Reset captcha after failed attempt
                isCaptchaVerified = false;
                captchaCheckbox.classList.remove('checked');
                loginButton.disabled = true;
                
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    if (loginAttempts >= MAX_LOGIN_ATTEMPTS - 1) {
                        showError('login-form-error', `Invalid email or password. You have ${MAX_LOGIN_ATTEMPTS - loginAttempts} attempt remaining.`);
                    } else {
                        showError('login-form-error', 'Invalid email or password');
                    }
                } else if (error.code === 'auth/too-many-requests') {
                    showError('login-form-error', 'Too many failed login attempts. Please try again later or reset your password.');
                } else {
                    showError('login-form-error', 'An error occurred during login. Please try again.');
                }
                
                button.disabled = false;
                spinner.style.display = 'none';
            }
        });
    } catch (error) {
        showError('login-form-error', 'An error occurred. Please try again.');
        button.disabled = false;
        spinner.style.display = 'none';
    }
});

// Real-time input validation
document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', () => {
        const error = validateInput(input);
        const errorElement = document.getElementById(`${input.id}-error`);
        if (errorElement) {
            errorElement.textContent = error || '';
            errorElement.style.display = error ? 'block' : 'none';
        }
    });
    
    // Clear form error on input change
    input.addEventListener('focus', () => {
        const formErrorId = input.closest('form').id.replace('-form', '-form-error');
        const formErrorElement = document.getElementById(formErrorId);
        if (formErrorElement) {
            formErrorElement.textContent = '';
            formErrorElement.style.display = 'none';
        }
    });
});

// Check if user is already logged in
auth.onAuthStateChanged(async (user) => {
    if (user) {
        try {
            const userDoc = await getDoc(doc(db, 'users', user.uid));
            if (userDoc.exists()) {
                // User is already authenticated, redirect to app
                window.location.href = 'half.html';
            }
        } catch (error) {
            console.error("Error checking user data:", error);
        }
    }
});


    </script>


<script>
  // Immediately hide everything to prevent flickering  
  document.documentElement.style.visibility = 'hidden';
  
  // Check local storage for theme preference from the page  
  const themePreference = localStorage.getItem('twitter-theme') || 'light';
  
  // Define luxury gradient (static but refined)  
  const luxuryGradient = `linear-gradient(
    135deg,  
    #0f0f0f 0%,  
    #1c1c1c 15%,  
    #3a3a3a 30%,  
    #4d4d4d 45%,  
    #626262 60%,  
    #787878 75%,  
    #8f8f8f 90%,  
    #a6a6a6 100%
  )`;
  
  // Create splash screen container  
  const splashScreen = document.createElement('div');
  splashScreen.style.cssText = `  
    position: fixed;  
    top: 0;  
    left: 0;  
    width: 100vw;  
    height: 100vh;  
    background-color: ${themePreference === 'light' ? '#f7f9fa' : themePreference === 'dim' ? '#15202b' : '#000000'};  
    display: flex;  
    flex-direction: column;  
    justify-content: center;  
    align-items: center;  
    z-index: 9999;  
    opacity: 1;  
    transition: opacity 0.5s ease-in-out;  
  `;
  
  // Create content wrapper  
  const contentWrapper = document.createElement('div');
  contentWrapper.style.cssText = `  
    position: relative;  
    height: 100%;  
    width: 100%;  
    display: flex;  
    flex-direction: column;  
    justify-content: center;  
    align-items: center;  
  `;
  
  // Create logo container - positioned in the middle  
  const logoContainer = document.createElement('div');
  logoContainer.style.cssText = `  
    position: absolute;  
    top: 50%;  
    left: 50%;  
    transform: translate(-50%, -50%);  
    width: 96px;  
    height: 96px;  
    display: flex;  
    justify-content: center;  
    align-items: center;  
  `;
  
  // Add style for the circle border (now thicker and more polished)
  const styleElement = document.createElement('style');
  styleElement.textContent = `  
    #splash-screen-logo::before {  
        content: '';  
        position: absolute;  
        top: -8px;  
        left: -8px;  
        right: -8px;  
        bottom: -8px;  
        border-radius: 50%;  
        background: ${luxuryGradient};  
        -webkit-mask:   
            linear-gradient(#fff 0 0) content-box,   
            linear-gradient(#fff 0 0);  
        -webkit-mask-composite: xor;  
        mask-composite: exclude;  
        border: 8px solid transparent;  
        z-index: 1;
        padding: 2px; /* Adds smoothness to the gradient edge */
    }  
  `;
  
  document.head.appendChild(styleElement);
  
  // Logo design with refined gradient border  
  const logoPlaceholder = document.createElement('div');
  logoPlaceholder.id = 'splash-screen-logo';
  logoPlaceholder.style.cssText = `  
    width: 100%;  
    height: 100%;  
    border-radius: 50%;  
    display: flex;  
    justify-content: center;  
    align-items: center;  
    position: relative;  
    background: ${themePreference === 'light' ? '#f7f9fa' : themePreference === 'dim' ? '#15202b' : '#000000'};
  `;
  
  const logoText = document.createElement('span');
  logoText.textContent = 'N';
  logoText.style.cssText = `  
    font-size: 48px;  
    font-weight: 700;  
    background: ${luxuryGradient};  
    -webkit-background-clip: text;  
    background-clip: text;  
    color: transparent;  
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;  
    z-index: 2;  
    letter-spacing: -1px;
  `;
  logoPlaceholder.appendChild(logoText);
  logoContainer.appendChild(logoPlaceholder);
  
  // Create company info container at the bottom  
  const companyInfoContainer = document.createElement('div');
  companyInfoContainer.style.cssText = `  
    position: absolute;  
    bottom: 15%;  
    left: 50%;  
    transform: translateX(-50%);  
    display: flex;  
    flex-direction: column;  
    align-items: center;  
    text-align: center;
  `;
  
  // Create "from" text (more elegant)
  const tagline = document.createElement('div');
  tagline.style.cssText = `  
    font-size: 14px;  
    color: ${themePreference === 'light' ? '#657786' : '#8899a6'};  
    margin-bottom: 6px;  
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;  
    font-weight: 400;
    letter-spacing: 0.5px;
    opacity: 0.8;
  `;
  tagline.textContent = 'from';
  
  // Create company name with refined gradient
  const companyName = document.createElement('h1');
  companyName.textContent = 'nmedea';
  companyName.style.cssText = `  
    font-size: 24px;  
    font-weight: 600;  
    margin: 0;  
    letter-spacing: 0.8px;  
    background: ${luxuryGradient};  
    -webkit-background-clip: text;  
    background-clip: text;  
    color: transparent;  
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;  
    text-transform: lowercase;
  `;
  
  // Append elements  
  companyInfoContainer.appendChild(tagline);
  companyInfoContainer.appendChild(companyName);
  contentWrapper.appendChild(logoContainer);
  contentWrapper.appendChild(companyInfoContainer);
  splashScreen.appendChild(contentWrapper);
  
  // Add to body immediately  
  document.body.insertBefore(splashScreen, document.body.firstChild);
  
  // Show the splash screen immediately  
  document.documentElement.style.visibility = 'visible';
  
  // Find and hide the auth container if it exists  
  const hideAuthContainer = () => {
    const authContainer = document.querySelector('.auth-container');
    if (authContainer) {
      authContainer.style.opacity = '0';
      authContainer.style.pointerEvents = 'none';
      authContainer.style.position = 'fixed';
      authContainer.style.top = '-100%';
    }
  };
  
  // Try to hide the auth container  
  hideAuthContainer();
  
  // Give it another try after a delay in case DOM isn't ready  
  setTimeout(hideAuthContainer, 100);
  
  // Remove splash screen and show content  
  const removeSplashScreen = () => {
    splashScreen.style.opacity = '0';
    
    setTimeout(() => {
      if (document.body.contains(splashScreen)) {
        document.body.removeChild(splashScreen);
      }
      
      // Restore any hidden containers  
      const authContainer = document.querySelector('.auth-container');
      if (authContainer) {
        authContainer.style.position = 'static';
        authContainer.style.top = '0';
        authContainer.style.opacity = '1';
        authContainer.style.pointerEvents = 'auto';
      }
    }, 500);
  };
  
  // Remove after 11 seconds  
  setTimeout(removeSplashScreen, 11000);
  
  // Expose a method to easily replace the logo  
  window.replaceSplashScreenLogo = (logoUrl) => {
    const logoElement = document.getElementById('splash-screen-logo');
    if (logoElement) {
      // Clear existing content  
      logoElement.innerHTML = '';
      
      // Create and append new logo image  
      const logoImage = document.createElement('img');
      logoImage.src = logoUrl;
      logoImage.style.cssText = `  
        width: 100%;  
        height: 100%;  
        object-fit: contain;  
        border-radius: 50%;
      `;
      logoElement.appendChild(logoImage);
    }
  };
</script>
<script>
  function createDownloadNotification() {
    // Check if running as PWA or standalone app
    if (window.matchMedia('(display-mode: standalone)').matches ||
      window.navigator.standalone ||
      document.referrer.includes('android-app://')) {
      return; // Don't show notification if it's installed as PWA
    }
    
    // Check if it's an Apple device (iPhone, iPad, etc.)
    const isAppleDevice = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
    if (isAppleDevice) {
      return; // Don't show notification on Apple devices
    }
    
    // More thorough browser detection
    const isBrowser = () => {
      const ua = navigator.userAgent.toLowerCase();
      
      // Check if it's a WebView
      const isWebView = /(webview|wv)/.test(ua) ||
        /windows.*phone/.test(ua) ||
        /android.*mobile/.test(ua) && /wv/.test(ua);
      
      // Check if it's a known mobile browser
      const isMobileBrowser = /chrome|safari|firefox|opera|edge|ie/i.test(ua) &&
        !isWebView &&
        !ua.includes('samsung') &&
        !ua.includes('miui') &&
        !ua.includes('huawei');
      
      // Check if it's a desktop browser
      const isDesktopBrowser = /chrome|firefox|opera|edge|ie/i.test(ua) &&
        !/(android|iphone|ipad|ipod|windows phone)/i.test(ua);
      
      // Return true only for mobile browsers, exclude desktop browsers
      return isMobileBrowser && !isDesktopBrowser;
    };
    
    // Only proceed if it's a regular mobile browser
    if (!isBrowser()) {
      return;
    }
    
    // Detect OS for customizing the message
    const userAgent = navigator.userAgent.toLowerCase();
    const isAndroid = /android/.test(userAgent);
    const isWindows = /windows/.test(userAgent);
    
    // Create notification container
    const notification = document.createElement("div");
    notification.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: #ffffff;
        color: #1da1f2; /* Twitter blue for text */
        padding: 16px;
        border-radius: 16px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        gap: 12px;
        opacity: 0;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10000;
        max-width: 90%;
        width: auto;
    `;
    
    // Add icon (N circle with blue fill)
    const iconContainer = document.createElement("div");
    iconContainer.innerHTML = `
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#1da1f2" stroke="#1da1f2" stroke-width="2">
            <circle cx="12" cy="12" r="10" fill="#1da1f2" />
            <text x="50%" y="50%" text-anchor="middle" stroke="none" fill="#ffffff" font-size="12" dy=".3em">N</text>
        </svg>
    `;
    
    // Create content
    const content = document.createElement("div");
    content.innerHTML = `
        <div style="font-size: 14px; font-weight: 500; margin-bottom: 4px; color: #1da1f2;">
            Download Available
        </div>
        <div style="font-size: 12px; opacity: 0.7; color: #1da1f2;">
            ${isAndroid ? 'Get it on Android' : 'Download for Windows'}
        </div>
    `;
    
    // Create buttons container
    const buttons = document.createElement("div");
    buttons.style.cssText = `
        display: flex;
        gap: 8px;
        margin-left: 12px;
    `;
    
    // Create action buttons
    const installButton = document.createElement("button");
    installButton.textContent = "Install";
    installButton.style.cssText = `
        background: #1da1f2; /* Twitter blue */
        color: #ffffff;
        border: none;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.3s;
    `;
    
    const cancelButton = document.createElement("button");
    cancelButton.textContent = "Not Now";
    cancelButton.style.cssText = `
        background: transparent;
        color: #1da1f2; /* Twitter blue */
        border: 1px solid #1da1f2;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.3s;
    `;
    
    // Add hover effects
    installButton.onmouseover = () => installButton.style.background = '#1991db'; /* Darker blue on hover */
    installButton.onmouseout = () => installButton.style.background = '#1da1f2';
    cancelButton.onmouseover = () => cancelButton.style.background = 'rgba(29, 161, 242, 0.1)'; /* Light blue on hover */
    cancelButton.onmouseout = () => cancelButton.style.background = 'transparent';
    
    // Handle button clicks
    installButton.onclick = () => {
      if (isAndroid) {
        const link = document.createElement('a');
        link.href = 'https://median.co/share/zjajxa#apk';
        link.download = 'app.apk';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        window.open('https://median.co/share/zjajxa#apk', '_blank');
      }
      hideNotification();
    };
    
    cancelButton.onclick = hideNotification;
    
    // Assemble notification
    buttons.appendChild(installButton);
    buttons.appendChild(cancelButton);
    notification.appendChild(iconContainer);
    notification.appendChild(content);
    notification.appendChild(buttons);
    document.body.appendChild(notification);
    
    // Show animation
    setTimeout(() => {
      notification.style.opacity = '1';
      notification.style.transform = 'translateX(-50%) translateY(0)';
    }, 100);
    
    function hideNotification() {
      notification.style.opacity = '0';
      notification.style.transform = 'translateX(-50%) translateY(100px)';
      setTimeout(() => notification.remove(), 500);
    }
  }
  
  // Show notification when page loads
  window.addEventListener('load', createDownloadNotification);
</script>
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "b7b291e1-5bd8-46b6-b698-ade4de650caa",
    });
  });
</script>
<script>

// Theme Support for Login Form
(function() {
  // Check local storage for theme preference
  const themePreference = localStorage.getItem('twitter-theme') || 'light';
  
  // Define luxury gradient based on theme
  const luxuryGradient = `linear-gradient(
    135deg,  
    #0f0f0f 0%,  
    #1c1c1c 15%,  
    #3a3a3a 30%,  
    #4d4d4d 45%,  
    #626262 60%,  
    #787878 75%,  
    #8f8f8f 90%,  
    #a6a6a6 100%
  )`;
  
  // Define color variables for different themes
  const themeColors = {
    light: {
      background: '#f7f9fa',
      card: '#ffffff',
      text: '#14171A',
      textLight: '#657786',
      border: '#E1E8ED'
    },
    dim: {
      background: '#15202b',
      card: '#1e2732',
      text: '#ffffff',
      textLight: '#8899a6',
      border: '#38444d'
    },
    dark: {
      background: '#000000',
      card: '#16181c',
      text: '#ffffff',
      textLight: '#8899a6',
      border: '#2f3336'
    }
  };
  
  // Get theme colors
  const colors = themeColors[themePreference];
  
  // Create and inject theme CSS
  const themeStyle = document.createElement('style');
  themeStyle.textContent = `
    :root {
      --background: ${colors.background};
      --card: ${colors.card};
      --text: ${colors.text};
      --text-light: ${colors.textLight};
      --border: ${colors.border};
    }
    
    body {
      background-color: var(--background);
      color: var(--text);
    }
    
    .logo {
      color: ${themePreference === 'light' ? 'transparent' : '#ffffff'};
      background: ${themePreference === 'light' ? luxuryGradient : 'none'};
      -webkit-background-clip: ${themePreference === 'light' ? 'text' : 'none'};
      background-clip: ${themePreference === 'light' ? 'text' : 'none'};
      opacity: ${themePreference === 'light' ? '1' : '0.9'};
    }
    
    .auth-option {
      background: var(--card);
      border-color: var(--border);
    }
    
    .auth-option-title {
      color: var(--text);
    }
    
    .auth-option-description {
      color: var(--text-light);
    }
    
    .auth-option-icon {
      color: ${themePreference === 'light' ? '#626262' : '#ffffff'};
    }
    
    .modal {
      background: var(--card);
    }
    
    .modal-header h3 {
      color: var(--text);
    }
    
    .modal-header p {
      color: var(--text-light);
    }
    
    label {
      color: var(--text);
    }
    
    input {
      background: ${themePreference === 'light' ? 'var(--background)' : 'rgba(255, 255, 255, 0.1)'};
      color: var(--text);
      border-color: var(--border);
    }
    
    input:focus {
      background: ${themePreference === 'light' ? 'var(--card)' : 'rgba(255, 255, 255, 0.15)'};
    }
    
    .loading-text {
      color: var(--text);
    }
    
    .loading-subtext {
      color: var(--text-light);
    }
    
    .loading-progress {
      background-color: var(--border);
    }
    
    /* Special handling for dark themes and auth options hover */
    ${themePreference !== 'light' ? `
      .auth-option:hover {
        border-color: #626262;
      }
      
      .auth-option:hover .auth-option-title,
      .auth-option:hover .auth-option-description {
        color: white;
      }
      
      .auth-option:before {
        background: ${luxuryGradient};
        opacity: 0;
      }
      
      .auth-option:hover:before {
        opacity: 0.9;
      }
    ` : ''}
  `;
  
  document.head.appendChild(themeStyle);
  
  // Listen for theme changes
  window.addEventListener('storage', function(event) {
    if (event.key === 'twitter-theme') {
      // Reload the page to apply new theme
      window.location.reload();
    }
  });
  
  // Add theme switcher (optional)
  const createThemeSwitcher = () => {
    const switcher = document.createElement('div');
    switcher.style.cssText = `
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 8px;
      z-index: 1000;
    `;
    
    const createThemeButton = (theme, label) => {
      const btn = document.createElement('button');
      btn.textContent = label;
      btn.style.cssText = `
        padding: 8px 12px;
        border-radius: 20px;
        border: none;
        background: ${theme === 'light' ? '#f7f9fa' : theme === 'dim' ? '#15202b' : '#000000'};
        color: ${theme === 'light' ? '#14171A' : '#ffffff'};
        cursor: pointer;
        font-size: 12px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      `;
      
      if (theme === themePreference) {
        btn.style.outline = '2px solid #626262';
      }
      
      btn.addEventListener('click', () => {
        localStorage.setItem('twitter-theme', theme);
        window.location.reload();
      });
      
      return btn;
    };
    
    switcher.appendChild(createThemeButton('light', 'Light'));
    switcher.appendChild(createThemeButton('dim', 'Dim'));
    switcher.appendChild(createThemeButton('dark', 'Dark'));
    
    document.body.appendChild(switcher);
  };
  
  // Uncomment to enable theme switcher
  // createThemeSwitcher();
  
  // Update logo based on theme
  const updateLogo = () => {
    const logo = document.querySelector('.logo');
    if (logo) {
      if (themePreference !== 'light') {
        logo.style.color = '#ffffff';
        logo.style.opacity = '0.9';
        logo.style.background = 'none';
        logo.style.webkitBackgroundClip = 'none';
        logo.style.backgroundClip = 'none';
      }
    }
  };
  
  // Run when DOM is loaded
  document.addEventListener('DOMContentLoaded', updateLogo);
  
  // Try to update logo immediately in case DOM is already loaded
  updateLogo();
})();

</script>